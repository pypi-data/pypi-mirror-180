(function(){"use strict";var t={1542:function(t,e,s){var r=s(4367),n=(s(8674),s(9601),s(7727),s(538)),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("trame-connect",{attrs:{"use-url":"","forward-errors":""}},[s("trame-server-template",{attrs:{"use-url":""}})],1)},a=[],o=function(){var t=this,e=t.$createElement;t._self._c;return t.ready?t._t("default"):t._e()},l=[],c=(s(3948),s(6699),s(2023),s(285),s(1637),s(9714),s(4916),s(5306),s(8757),s(7807)),u=s(8923),h=s(4934),m=t=>({getArray(e,s=!0){return t.call("viewport.geometry.array.get",[e,s])},getViewState(e,s=!1){return t.call("viewport.geometry.view.get.state",[e,s])},addViewObserver(e){return t.call("viewport.geometry.view.observer.add",[e])},removeViewObserver(e){return t.call("viewport.geometry.view.observer.remove",[e])},subscribeToViewChange(e){return t.subscribe("viewport.geometry.view.subscription",e)},unsubscribe(e){return t.unsubscribe(e)}}),d=t=>({lifeCycleUpdate(e){return t.call("trame.lifecycle.update",[e])},sendError(e){return t.call("trame.error.client",[e])},getState(){return t.call("trame.state.get",[])},trigger(e,s=[],r={}){return t.call("trame.trigger",[e,s,r])},updateState(e){return t.call("trame.state.update",[e])},subscribeToStateUpdate(e){return t.subscribe("trame.state.topic",e)},subscribeToActions(e){return t.subscribe("trame.actions.topic",e)},unsubscribe(e){return t.unsubscribe(e)}}),p={SyncView:m,Trame:d};h.ZP.setSmartConnectClass(u.ZP);const f={},y={"http:":"ws:","https:":"wss:","ws:":"ws:","wss:":"wss:"},g=["unsubscribe","subscribeToViewChange","subscribeToStateUpdate","subscribeToActions","subscribeToViewChange"];function v(t){const e=(0,r.Z)({},t);if(e.sessionURL){let t=e.sessionURL.toLowerCase();const s=window.location;if(t.includes("use_")){const e=new URL(t);e.protocol=y[s.protocol],t=e.toString()}const r={use_hostname:s.hostname,use_host:s.host};for(const[e,n]of Object.entries(r))t=t.replaceAll(e,n);e.sessionURL=t}e.application=document.querySelector("html").dataset.appName||e.application;const s=document.querySelector("html").dataset.sessionManagerUrl||e.sessionManagerURL;return s&&(e.sessionManagerURL=s),e.useUrl?(0,r.Z)((0,r.Z)({},e),c.Z.extractURLParameters()):e}function b(){return h.ZP.newInstance({protocols:p,configDecorator:v,notBusyList:g})}function w(t){var e;let s=null===(e=f[t])||void 0===e?void 0:e.client;if(!s){s=b();const r=[],n={type:"created",message:"Client connected..."};function i(e){f[t].status=e}f[t]={client:s,status:n,subscriptions:r},r.push(s.onConnectionError((t=>{var e;i({type:"Connection error",message:null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.error})}))),r.push(s.onConnectionClose((t=>{var e;i({type:"Connection close",message:null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.error})})))}return s}function T(t){return f[t].status}var _={getClient:w,getStatus:T,configDecorator:v},S=(s(8862),s(9274)),C=s(7117);s(2707);const $={};function O(t,e){return t.priority-e.priority}function R(t){$.addAttachement=t}const A=2e6,E={priority:0,async decorate(t){if(null===t||void 0===t)return t;if(t.constructor&&t.constructor===File){const{name:e,lastModified:s,size:r,type:n}=t,i=await new Promise((e=>{const s=new FileReader;s.addEventListener("loadend",(()=>{e(s.result)})),s.readAsArrayBuffer(t)}));let a=null;if(i.byteLength<A)a=$.addAttachement(i);else{a=[];let t=0,e=A;while(t<i.byteLength)e>i.byteLength&&(e=i.byteLength),a.push($.addAttachement(i.slice(t,e))),t=e,e+=A}return{name:e,lastModified:s,size:r,type:n,content:a,_filter:["content"]}}return t}},L={priority:0,async decorate(t){if(null===t||void 0===t)return t;if("string"===typeof t)return t;if(t.constructor&&t.constructor===FileList||t.length){const e=[];for(let s=0;s<t.length;s++)e.push(await E.decorate(t[s]));return e}return t}},U={priority:0,async decorate(t){if(null===t||void 0===t)return t;if("string"===typeof t)return t;if(t.constructor&&t.constructor===Object){const e={},s=Object.keys(t);for(let r=0;r<s.length;r++){const n=s[r];e[n]=t[n],e[n]=await L.decorate(e[n]),e[n]=await E.decorate(e[n])}return e}return t}},j=[E,L,U];function k(t){j.push(t),j.sort(O)}async function x(t){let e=t;for(let s=0;s<j.length;s++){if(null===e||void 0===e)return e;e=await j[s].decorate(e)}return e}s(3123);const Z=["type","key","keyCode","controlKey","altKey","shiftKey","position","spinX","spinY","pixelX","pixelY"];function N(t){const e={};for(let s=0;s<Z.length;s++){const r=Z[s];r in t&&(e[r]=t[r])}return e}var I={event:N};s(6977);function B(t,e=[],s=1e3,r=2){if(null===t)return null;for(let n=0;n<e.length;n++){const i=Array.isArray(s)?s[n]:s,a=e[n];if(!(t>i))return`${t.toFixed(r)} ${a}`;t/=i}return`${t.toFixed(r)} ${s[s.length-1]}`}function P(t,e=2){return B(t,["B","KB","MB","GB","TB","PB"],1024,e)}var D={number:B,bytes:P};async function K(t,e,s="application/octet-stream"){const r=await Promise.resolve(e),n=new Blob([r],{type:s}),i=URL.createObjectURL(n),a=document.createElement("a");a.setAttribute("href",i),a.setAttribute("download",t),document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout((()=>URL.revokeObjectURL(i)),1e3)}function V(t,e=window){let s=e;const r=t.split(".");for(let n=0;n<r.length;n++)s=s[r[n]];return s}function M(t){try{return JSON.stringify(t),t}catch(r){}const e={},s=Object.keys(t);for(let n=0;n<s.length;n++){const i=s[n],a=t[i];if(Array.isArray(a))e[i]=a.map(M);else try{JSON.stringify(a),e[i]=a}catch(r){continue}}return e}var F={download:K,get:V,safe:M,vtk:I,fmt:D};function q(t){const e={tts:0};return t.forEach((t=>{e[t]=0})),new n.Z({data:e})}function J(t,e){function s(t){for(let s=0;s<t.length;s++)e[t[s]]++}return t.$on("stateChange",s),()=>{t.$off("stateChange",s)}}function z(t,e,s){const r={};return e.forEach((e=>{r[e]={get(){return s[e],t.state.get(e)},set(s){t.state.set(e,s)}}})),r}window.trame||(window.trame={}),window.trame.utils||(window.trame.utils=F);const H={},X={};async function Y(t,e){for(let s=0;s<t.length;s++)await e(t[s])}function G(t,e){const s=[],r={};for(let a=0;a<t.length;a++){let e=s,n=t[a];if(Array.isArray(n)){const t=n[1].serial;t&&(r[t]||(r[t]=[]),e=r[t]),[n]=n}e.push(n)}const n=s.map(e),i=Object.values(r);for(let a=0;a<i.length;a++)n.push(Y(i[a],e));return Promise.all(n)}async function Q(t,e,s=[]){const r=t=>!s.includes(t);t.includes("trame__styles")&&await G(e.trame__styles.filter(r),S.j),t.includes("trame__scripts")&&await G(e.trame__scripts.filter(r),S.ve),t.includes("trame__vue_use")&&e.trame__vue_use.forEach((t=>{let e=t,r={};Array.isArray(t)&&([e,r]=t);let i=F.get(e);i?X[e]||s.includes(e)||(X[e]=!0,i.default&&(i=i.default),console.info(`Vue.use(${e}, ${JSON.stringify(r)}) - ${!!i} - install(${!!i.install})`),i.install?(n.Z.use(i,r),i.getOptions&&Object.assign(H,i.getOptions())):n.Z.use({install:i},r)):console.error(`Lookup error: Vue.use(${e}, ${JSON.stringify(r)})`)})),t.includes("trame__favicon")&&e.trame__favicon&&(document.querySelector("link[rel=icon]").href=e.trame__favicon),t.includes("trame__title")&&e.trame__title&&(document.title=e.trame__title)}class W{constructor(t,e=null,s=[]){this.name="Default trame application",this.vueInstance=t,this.client=(null===t||void 0===t?void 0:t.client)||e,this.exclude=(null===t||void 0===t?void 0:t.exclude)||s,this.subscriptions=[],this.state={},this.keyTS={},this.ts=0,this.trameTemplateTS=0,this.trameTemplate={template:"<div>Too early for trame template</div>"},this.dirtyKeys=new Set,this.registerDecorator=k;const r=async t=>{const e=[],s=Object.keys(t);for(let a=0;a<s.length;a++){var r;let n=!0;const i=s[a],o=t[i];if(null!==o&&void 0!==o&&null!==(r=o._filter)&&void 0!==r&&r.length){n=!1;const t=this.state[i],e=Object.keys(o);for(let s=0;!n&&s<e.length;s++){const r=e[s];"_"!==r[0]&&(void 0!==t&&t[r]===o[r]||(n=!0))}}n&&(e.push(i),this.state[i]=o)}this.ts+=1;let n=0;for(let a=0;a<e.length;a++){const t=e[a];void 0===this.keyTS[t]&&n++,this.keyTS[t]=this.ts}var i;if((await Q(e,this.state,this.exclude),n&&(this.updateTrameTemplate(),this.vueInstance&&this.vueInstance.$emit("trameTemplateChange",this.trameTemplateTS)),this.vueInstance)&&(this.vueInstance.$emit("stateChange",e),this.vueInstance.$router&&null!==t&&void 0!==t&&null!==(i=t.trame__routes)&&void 0!==i&&i.length)){const e=this.vueInstance.$router;t.trame__routes.forEach((t=>{e.addRoute(t)}))}};this.subscriptions.push(this.client.getRemote().Trame.subscribeToStateUpdate((([t])=>r(t)))),this.client.getRemote().Trame.getState().then((({state:e,name:s})=>{this.name=s,r(e),t&&(t.ready=!0)})),this._updateFromServer=r}updateTrameTemplate(){if(!this.vueInstance)return;this.trameTemplateTS+=1;const t=Object.keys(this.state),e=q(t),s=J(this.vueInstance,e),n=z(this.vueInstance,t,e);let i=0;this.trameTemplate={name:"TrameTemplate",inject:["trame"],props:{templateName:{type:String,default:"main"}},components:{VRuntimeTemplate:C.Z},computed:(0,r.Z)((0,r.Z)({},n),{},{contentTemplate(){const t=`trame__template_${this.templateName}`;return this[t]||`<div>No state variable for ${t} with the following state.<br><pre>${JSON.stringify(this.trame.state.get(),null,2)}</pre></div>`},tts(){return e.tts},utils(){return F}}),watch:{contentTemplate(){setTimeout((()=>e.tts+=1),10)}},methods:{set(t,e){return this.trame.state.set(t,e)},get(t=null){return this.trame.state.get(t)},setAll(t){return this.trame.state.update(t)},flushState(...t){return this.trame.state.flush(...t)},registerDecorator(...t){return this.trame.state.registerDecorator(...t)},async trigger(t,e=[],s={}){let r=[];const n={};if(e){const t=e.map((t=>x(t)));r=await Promise.all(t)}if(s){const t=[],e=[];Object.entries(s).forEach(((s,r)=>{t.push(s),e.push(x(r))}));const r=await Promise.all(e);for(let s=0;s<t.length;s++)n[t[s]]=r[s]}return await this.trame.client.getRemote().Trame.trigger(t,r,n)},getRef(t){const{trameTemplateRootRef:e}=this.$refs;return e.$refs&&e.$refs[t]?e.$refs[t]:e.$children[0].$refs[t]},execAction(t){const{ref:e,type:s}=t,r=this.getRef(e);if(r&&"method"===s){const{method:e,args:s}=t;r[e](...s)}if(r&&"property"===s){const{property:e,value:s}=t;r[e]=s}}},created(){i++,this.onActions=([t])=>{for(let e=0;e<t.length;e++)this.execAction(t[e])},this.clientSub=this.trame.client.getRemote().Trame.subscribeToActions(this.onActions)},beforeDestroy(){i--,0===i&&s(),this.trame.client.getRemote().Trame.unsubscribe(this.clientSub)},template:'<v-runtime-template ref="trameTemplateRootRef" :template="contentTemplate" />'}}delete(){while(this.subscriptions.length)this.client.getRemote().Trame.unsubscribe(this.subscriptions.pop())}get(t){return void 0===t?this.state:this.state[t]}getTimeStamp(t){return this.keyTS[t]||0}async set(t,e){this.state[t]!==e&&(this.ts+=1,this.state[t]=e,this.keyTS[t]=this.ts,this.dirty(t),await this.flush())}async update(t){this.ts+=1;for(const[e,s]of Object.entries(t))this.state[e]!==s&&(this.state[e]=s,this.keyTS[e]=this.ts,this.dirty(e));await this.flush()}canDirty(t){return!this.state.trame__client_only.includes(t)}dirty(...t){t.forEach((t=>{this.canDirty(t)&&this.dirtyKeys.add(t),this.vueInstance&&this.vueInstance.$emit("stateChange",[t])}))}async flush(...t){if(t.length&&t.forEach((t=>{Array.isArray(t)?this.dirty(...t):this.dirty(t)})),this.dirtyKeys.size&&!this.client.isBusy()){const t=[],e=[];this.dirtyKeys.forEach((s=>{t.push(x(this.state[s])),e.push(s)})),this.dirtyKeys.clear();const s=await Promise.all(t),r=e.map(((t,e)=>({key:t,value:s[e]})));await this.client.getRemote().Trame.updateState(r),this.dirtyKeys.size&&this.flush()}this.vueInstance&&!this.vueInstance.connected&&this._updateFromServer(this.state)}}var tt={name:"TrameConnect",props:{name:{type:String,default:"TrameConnect"},config:{type:Object,default:()=>({application:"trame"})},exclude:{type:Array,default:()=>[]},useUrl:{type:Boolean,default:!1},forwardErrors:{type:Boolean,default:!1}},data(){return{ready:!1,connected:!1,busy:1,status:{type:"created",message:"Connecting..."}}},async created(){if(this.subscriptions=[],this.client=_.getClient(this.name),this.subscriptions.push(this.client.onBusyChange((t=>{const e=!t!==!this.busy;this.busy=t,e&&this.state&&this.state.set("trame__busy",t),0===t&&this.state.flush(),e&&this.$emit("busyChange",t)}))),this.subscriptions.push(this.client.onConnectionError((t=>{var e,s;this.connected=!1,this.status={type:"Connection error",message:null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.error},this.reportError((null===t||void 0===t||null===(s=t.response)||void 0===s?void 0:s.error)||"Connection error"),this.$emit("statusChange",this.status)}))),this.subscriptions.push(this.client.onConnectionClose((t=>{var e,s;this.connected=!1,this.status={type:"Connection close",message:null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.error},this.reportError((null===t||void 0===t||null===(s=t.response)||void 0===s?void 0:s.error)||"Connection close"),this.$emit("statusChange",this.status)}))),this.client.isConnected()?(this.status=_.getStatus(this.name),this.$emit("statusChange",this.status)):(await this.client.connect(_.configDecorator((0,r.Z)((0,r.Z)({},this.config),{},{useUrl:this.useUrl}))),R(this.client.getConnection().getSession().addAttachment),this.status={type:"Connected"}),this.connected=this.client.isConnected(),this.busy=this.client.isBusy(),this.$emit("statusChange",this.status),this.connected&&(this.state=new W(this)),this.client.getRemote().Trame.lifeCycleUpdate("client_connected"),window.addEventListener("beforeunload",(()=>this.client.getRemote().Trame.lifeCycleUpdate("client_exited"))),this.forwardErrors){const t=console.error;console.error=(...e)=>{try{this.client.getRemote().Trame.sendError(e.join(" "))}catch(s){t(s)}finally{t(...e)}},window.addEventListener("error",(t=>{console.error(`${t.type}: ${t.message}`)}))}},beforeDestroy(){this.client.getRemote().Trame.lifeCycleUpdate("client_unmounted");while(this.subscriptions.length)this.subscriptions.pop().unsubscribe();this.state&&(this.state.delete(),this.state=null)},methods:{reportError(t="Something unexpected happened..."){this.state.set("trame__template_main",`<trame-loading message="${t}"/>`)},async trigger(t,e=[],s={}){return await this.client.getRemote().Trame.trigger(t,e,s)}},provide(){return{trame:this}}},et=tt,st=s(1001),rt=(0,st.Z)(et,o,l,!1,null,null,null),nt=rt.exports,it=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("trame-template",{key:t.trameTemplateTS,attrs:{templateName:t.tName}})},at=[],ot={name:"TrameServerTemplate",inject:["trame"],props:{templateName:{type:String,default:"main"},urlKey:{type:String,default:"ui"},useUrl:{type:Boolean,default:!1}},data(){return{trameTemplateTS:0}},computed:{tName(){return this.useUrl&&c.Z.extractURLParameters()[this.urlKey]?c.Z.extractURLParameters()[this.urlKey]:this.templateName}},created(){this.onNewTemplate=()=>{this.$options.components.trameTemplate=this.trame.state.trameTemplate,this.trameTemplateTS=this.trame.state.trameTemplateTS},this.trame.$on("trameTemplateChange",this.onNewTemplate),this.onNewTemplate()},beforeDestroy(){this.trame.$off("trameTemplateChange",this.onNewTemplate)}},lt=ot,ct=(0,st.Z)(lt,it,at,!1,null,null,null),ut=ct.exports,ht={name:"App",components:{TrameConnect:nt,TrameServerTemplate:ut}},mt=ht,dt=(0,st.Z)(mt,i,a,!1,null,null,null),pt=dt.exports,ft=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{class:t.$style.container},[s("div",{class:t.$style.loader}),s("div",{class:t.$style.message},[t._v(" "+t._s(t.message)+" ")])])},yt=[],gt={name:"Loading",props:{message:{type:String,default:"Loading..."}}},vt=gt,bt={container:"style_container_VCsHx",loader:"style_loader_CNsNi",spin:"style_spin_BAaPb",message:"style_message_rmggO"};function wt(t){this["$style"]=bt.locals||bt}var Tt=(0,st.Z)(vt,ft,yt,!1,wt,null,null),_t=Tt.exports,St=function(){var t=this,e=t.$createElement;t._self._c;return t._t("default",null,null,t.state)},Ct=[];function $t(...t){const e={};for(let s=0;s<t.length;s++)e[t[s]]=null;return e}function Ot(t,e,...s){return r=>{const{state:n}=t,i=new Set(r);for(let t=0;t<s.length;t++){const r=s[t];i.has(r)&&(e[r]=n.get(r))}}}var Rt={inject:["trame"],name:"TrameStateResolver",props:{names:{type:Array,default:()=>[]}},data(){return $t(...this.names)},computed:{state(){const t={trame:this.trame,set:(...t)=>this.trame.state.set(...t)};for(let e=0;e<this.names.length;e++){const s=this.names[e];t[s]=this[s]}return t}},created(){this.onStateChange=Ot(this.trame,this,...this.names),this.trame.$on("stateChange",this.onStateChange),this.onStateChange(this.names)},beforeDestroy(){this.trame.$off("stateChange",this.onStateChange)},provide(){return{state:this}}},At=Rt,Et=(0,st.Z)(At,St,Ct,!1,null,null,null),Lt=Et.exports;let Ut=1;function jt(){return"trame_style_elem_"+Ut++}var kt,xt,Zt={name:"TrameStyle",props:{css:{type:String,default:""}},watch:{css(t){this.updateStyle(t)}},created(){this.elemId=jt(),this.updateStyle(this.css)},beforeDestroy(){this.removeStyle()},methods:{updateStyle(t){let e=document.querySelector(`#${this.elemId}`);t?(e||(e=document.createElement("style"),e.id=this.elemId,document.head.appendChild(e)),e.innerHTML=t):this.removeStyle()},removeStyle(){const t=document.querySelector(`#${this.elemId}`);t&&t.parentNode.removeChild(t)}}},Nt=Zt,It=(0,st.Z)(Nt,kt,xt,!1,null,null,null),Bt=It.exports,Pt={TrameApp:pt,TrameConnect:nt,TrameLoading:_t,TrameServerTemplate:ut,TrameStateResolver:Lt,TrameStyle:Bt},Dt={install(t){Object.keys(Pt).forEach((e=>{t.component(e,Pt[e])}))}};const Kt="TrameConnect";function Vt(){const t=_.getStatus(Kt),e=document.querySelector(".trame__message");e&&(e.innerHTML=t.message||t.type)}async function Mt(t){window.Vue=t,t.use(Dt);const e=_.getClient(Kt);try{await e.connect(_.configDecorator({application:"trame",useUrl:!0}))}catch(n){return void Vt()}e.onConnectionError(Vt),e.onConnectionClose(Vt),R(e.getConnection().getSession().addAttachment);const{state:s}=await e.getRemote().Trame.getState();await Q(Object.keys(s),s),new t((0,r.Z)((0,r.Z)({},H),{},{render:t=>t(pt)})).$mount("#app")}Mt(n.Z)}},e={};function s(r){var n=e[r];if(void 0!==n)return n.exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,s),i.exports}s.m=t,function(){var t=[];s.O=function(e,r,n,i){if(!r){var a=1/0;for(u=0;u<t.length;u++){r=t[u][0],n=t[u][1],i=t[u][2];for(var o=!0,l=0;l<r.length;l++)(!1&i||a>=i)&&Object.keys(s.O).every((function(t){return s.O[t](r[l])}))?r.splice(l--,1):(o=!1,i<a&&(a=i));if(o){t.splice(u--,1);var c=n();void 0!==c&&(e=c)}}return e}i=i||0;for(var u=t.length;u>0&&t[u-1][2]>i;u--)t[u]=t[u-1];t[u]=[r,n,i]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var r in e)s.o(e,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,r){var n,i,a=r[0],o=r[1],l=r[2],c=0;if(a.some((function(e){return 0!==t[e]}))){for(n in o)s.o(o,n)&&(s.m[n]=o[n]);if(l)var u=l(s)}for(e&&e(r);c<a.length;c++)i=a[c],s.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return s.O(u)},r=self["webpackChunktrame_components"]=self["webpackChunktrame_components"]||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))}();var r=s.O(void 0,[998],(function(){return s(1542)}));r=s.O(r)})();
//# sourceMappingURL=app.3d4574df.js.map