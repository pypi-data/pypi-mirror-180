name: Project Code Coverarge
on:
  push:
    branches:
      - main
jobs:
  run_test_suite_and_flake8:
    name: Check coverage
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      # Setup Python environment in the container
      - uses: actions/setup-python@v3
        with:
          python-version: '3.10'
      - name: Install Python dependencies
        run: |
          pip install virtualenv
          python -m venv autodiff_venv
          source autodiff_venv/bin/activate
          echo "VIRTUAL ENV:" $VIRTUAL_ENV
          pip install -r requirements.txt
      - name: Run Test Suite
        run: python3 -m pytest --cov=src --cov-fail-under=90
  build-and-deploy:
    concurrency: ci-${{ github.ref }} # Recommended if you intend to make multiple deployments in quick succession.
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v3
      - uses: actions/setup-python@v3
        with:
          python-version: '3.10'
      - name: Install and Build üîß # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
        run: |
          pip install -r requirements.txt
          python3 -m pytest --cov=src --cov-report=html:htmlcov
          rm -f htmlcov/.gitignore

      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: htmlcov # The folder the action should deploy.
