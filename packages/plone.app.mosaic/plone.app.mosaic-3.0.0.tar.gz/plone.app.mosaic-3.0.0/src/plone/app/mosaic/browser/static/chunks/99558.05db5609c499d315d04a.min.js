"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[99558],{24283:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});var i=n(18872),a=n.n(i),o=n(24481),l=n.n(o),s=n(42860),r=n(10354),p=n(62832),c=n(97238),d=n(25219),u=s.Z.extend({name:"select2",trigger:".pat-select2",parser:"mockup",defaults:{separator:","},initializeValues:function(){var e=this;e.options.initialValues&&(e.options.id=function(e){return e.id},e.options.initSelection=function(t,n){var i=[],o=t.val(),l=e.options.initialValues;"string"==typeof e.options.initialValues&&""!==e.options.initialValues&&("{"===e.options.initialValues[0]?l=JSON.parse(e.options.initialValues):(l={},a()(e.options.initialValues.split(e.options.separator)).each((function(){var e=this.split(":"),t=a().trim(e[0]),n=a().trim(e[1]);l[t]=n})))),a()(o.split(e.options.separator)).each((function(){var e=this;l[this]&&(e=l[this]),i.push({id:p.Z.removeHTML(this),text:p.Z.removeHTML(e)})})),n(i)})},initializeTags:function(){var e=this;e.options.tags&&"string"==typeof e.options.tags&&("["===e.options.tags.substr(0,1)?e.options.tags=JSON.parse(e.options.tags):e.options.tags=e.options.tags.split(e.options.separator)),e.options.tags&&!e.options.allowNewItems&&(e.options.data=a().map(e.options.tags,(function(e,t){return{id:e,text:e}})),e.options.multiple=!0,delete e.options.tags)},initializeOrdering:async function(){if(!this.options.orderable)return;const e=(await n.e(37578).then(n.t.bind(n,37578,23))).default,t=()=>{const t=this.$select2[0].querySelector(".select2-choices");new e(t,{draggable:"li",dragClass:"select2-choice-dragging",chosenClass:"dragging",onStart:()=>this.$el.select2("onSortStart"),onEnd:()=>this.$el.select2("onSortEnd")})};this.$el.on("change",t.bind(this)),t()},initializeSelect2:async function(){n.e(35502).then(n.bind(n,35502)),n.e(30385).then(n.bind(n,30385)),await n.e(1891).then(n.t.bind(n,1891,23));try{await n(45753)(`./select2_locale_${this.options.language}`)}catch{console.warn("Language file could not be loaded",this.options.language)}var e=this;function t(t,n){return t?(e.options.debug&&console.debug("callback",t,n),"string"==typeof t&&(t=window[t]),t(n)):t}e.options.formatResultCssClass=function(e){if(e.id)return"select2-option-"+e.id.toLowerCase().replace(/[ \:\)\(\[\]\{\}\_\+\=\&\*\%\#]/g,"-")},a()(e.el).select2(e.options),e.$el.on("select2-selected",(function(n){t(e.options.onSelected,n)})),e.$el.on("select2-selecting",(function(n){t(e.options.onSelecting,n)})),e.$el.on("select2-deselecting",(function(n){t(e.options.onDeselecting,n)})),e.$el.on("select2-deselected",(function(n){t(e.options.onDeselected,n)})),e.$select2=e.$el.parent().find(".select2-container"),e.$el.parent().off("close.plone-modal.patterns"),e.options.orderable&&e.$select2.addClass("select2-orderable")},opened:function(){return 1===a()(".select2-dropdown-open",this.$el.parent()).length},init:async function(){var e=this,t=new d.Z;if(e.options.language=t.currentLanguage,e.options.allowNewItems=!e.options.hasOwnProperty("allowNewItems")||JSON.parse(e.options.allowNewItems),e.options.ajax||e.options.vocabularyUrl){e.options.vocabularyUrl&&(e.options.multiple=void 0===e.options.multiple||e.options.multiple,e.options.ajax=e.options.ajax||{},e.options.ajax.url=e.options.vocabularyUrl,e.options.initSelection=function(t,n){var i=[],o=t.val();a()(o.split(e.options.separator)).each((function(){var e=p.Z.removeHTML(this);i.push({id:e,text:e})})),n(i)});var n="";e.options.ajax=a().extend({quietMillis:300,data:function(e,t){return n=e,{query:e,page_limit:10,page:t}},results:function(t,i){var o=t.results;if(e.options.vocabularyUrl){var l=[];a().each(t.results,(function(e,t){l.push(t.id)})),o=[];var s=""===n||a().inArray(n,l)>=0;e.options.allowNewItems&&!s&&(n=p.Z.removeHTML(n),o.push({id:n,text:n})),a().each(t.results,(function(e,t){o.push(t)}))}return{results:o}}},e.options.ajax)}else if(e.options.multiple&&e.$el.is("select")){var i=e.$el.val()||[],o=a().map(e.$el.find("option"),(function(e){return{text:a()(e).html(),id:e.value}})),l=a()('<input type="hidden" />');l.val(i.join(e.options.separator)),l.attr("class",e.$el.attr("class")),l.attr("name",e.$el.attr("name")),l.attr("id",e.$el.attr("id")),e.$orig=e.$el,e.$el.replaceWith(l),e.$el=l,e.options.data=o}e.initializeValues(),e.initializeTags(),await e.initializeSelect2(),await e.initializeOrdering()}});const m=37,h=39;var g=s.Z.extend({name:"relateditems",trigger:".pat-relateditems",parser:"mockup",currentPath:void 0,selectedUIDs:[],openAfterInit:void 0,defaults:{vocabularyUrl:null,attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],basePath:"",pageSize:10,browsing:void 0,closeOnSelect:!0,contextPath:void 0,dropdownCssClass:"pat-relateditems-dropdown",favorites:[],recentlyUsed:!1,recentlyUsedMaxItems:20,recentlyUsedKey:"relateditems_recentlyused",maximumSelectionSize:-1,minimumInputLength:0,mode:"browse",orderable:!0,pathOperator:"plone.app.querystring.operation.string.path",rootPath:"/",rootUrl:"",scanSelection:!1,selectableTypes:null,separator:",",sortOn:null,sortOrder:"ascending",tokenSeparators:[","," "],upload:!1,uploadAllowView:void 0,breadcrumbTemplateSelector:null,favoriteTemplateSelector:null,recentlyusedTemplateSelector:null,resultTemplateSelector:null,selectionTemplateSelector:null,toolbarTemplateSelector:null,multiple:!0},recentlyUsed:function(e){var t=p.Z.storage.get(this.options.recentlyUsedKey)||[];t=t.slice(t.length-1e3,t.length),e&&t.filter(this.isSelectable.bind(this));var n=parseInt(this.options.recentlyUsedMaxItems,10);return n&&(t=t.slice(t.length-n,t.length)),t},applyTemplate:function(e,t){var n,i=this;i.options[e+"TemplateSelector"]&&(n=a()(i.options[e+"TemplateSelector"]).html()),n||(n=i.options[e+"Template"]?i.options[e+"Template"]:i[e+"Template"]);var o=a().extend(!0,{},i.options,t,{browsing:i.browsing,open_folder:(0,r.ZP)("Open folder"),current_directory:(0,r.ZP)("current directory:"),one_level_up:(0,r.ZP)("Go one level up")});return o._item=t,l().template(n)(o)},setAjax:function(){var e={url:this.options.vocabularyUrl,dataType:"JSON",quietMillis:500,data:function(e,t){var n=[];e&&(e="*"+e+"*",n.push({i:"SearchableText",o:"plone.app.querystring.operation.string.contains",v:e})),!this.browsing&&this.options.selectableTypes&&n.push({i:"portal_type",o:"plone.app.querystring.operation.selection.any",v:this.options.selectableTypes}),n.push({i:"path",o:this.options.pathOperator,v:this.options.rootPath+this.currentPath+(this.browsing?"::1":"")});var i=this.options.sortOn,a=i?this.options.sortOrder:null;return this.browsing&&null===i&&(i="getObjPositionInParent",a="ascending"),{query:JSON.stringify({criteria:n,sort_on:i,sort_order:a}),attributes:JSON.stringify(this.options.attributes),batch:JSON.stringify({page:t||1,size:this.options.pageSize})}}.bind(this),results:function(e,t){var n=t*this.options.pageSize<e.total,i=e.results;this.selectedUIDs=(a()(this.el).select2("data")||[]).map((function(e){return e.UID})),i=i.filter(function(e){return!!(this.browsing&&e.is_folderish||this.isSelectable(e)&&-1===this.selectedUIDs.indexOf(e.UID))}.bind(this));var o=this.currentPath.split("/");return 1===t&&this.browsing&&o.length>1&&"/"!==this.currentPath&&(i=[{oneLevelUp:!0,Title:(0,r.ZP)("One level up"),path:o.slice(0,o.length-1).join("/")||"/",currentPath:this.currentPath,is_folderish:!0,selectable:!1}].concat(i)),{results:i,more:n}}.bind(this)};this.options.ajax=e},renderToolbar:async function(){var e,t=this,i=t.currentPath.split("/"),o="",s="";l().each(i,(function(e){if(""!==e){var n={};n.path=o=o+"/"+e,n.text=e,s+=t.applyTemplate("breadcrumb",n)}}));var c="";l().each(t.options.favorites,(function(e){var n=l().clone(e);n.path=n.path.substr(t.options.rootPath.length)||"/",c+=t.applyTemplate("favorite",n)}));var d="";if(t.options.recentlyUsed){var u=t.recentlyUsed(!0);l().each(u.reverse(),(function(e){d+=t.applyTemplate("recentlyused",e)}))}async function m(e){let i=await Promise.resolve().then(n.bind(n,37103));i=i.default;const o=t.$toolbar[0].querySelector(".upload button");o.disabled=e;const l=t.$toolbar[0].querySelector(".upload .pat-upload"),s={success:(e,n)=>{const i=n.UID;if(i){new p.Z.QueryHelper({vocabularyUrl:t.options.vocabularyUrl,attributes:t.options.attributes}).search("UID","plone.app.querystring.operation.selection.is",i,(e=>{var n=t.$el.select2("data");n.push.apply(n,e.results),t.$el.select2("data",n,!0),t.emit("selected"),t.popover.hide()}),!1)}},uloadMultiple:!0,allowPathSelection:!1,relativePath:"fileUpload",baseUrl:t.options.rootUrl},r=new i(a()(l),s);o.addEventListener("show.bs.dropdown",(()=>{t.currentPath!==r.currentPath&&r.setPath(t.currentPath)}))}e=t.applyTemplate("toolbar",{items:s,favItems:c,favText:(0,r.ZP)("Favorites"),searchText:(0,r.ZP)("Current path:"),searchModeText:(0,r.ZP)("Search"),browseModeText:(0,r.ZP)("Browse"),recentlyUsedItems:d,recentlyUsedText:(0,r.ZP)("Recently Used"),icon_root:await p.Z.resolveIcon("house-fill"),icon_recently_used:await p.Z.resolveIcon("grid-fill"),icon_favorites:await p.Z.resolveIcon("star-fill"),icon_upload:await p.Z.resolveIcon("cloud-arrow-up"),upload:this.options.upload,upload_text:(0,r.ZP)("Upload")}),t.$toolbar.html(e),a()(".pat-relateditems-dropdown").unbind("mouseup"),a()(".pat-relateditems-dropdown").bind("mouseup",(function(e){e.stopPropagation()})),a()("button.mode.search",t.$toolbar).on("click",(function(e){e.preventDefault(),t.browsing?(a()("button.mode.search",t.$toolbar).toggleClass("btn-primary btn-default"),a()("button.mode.browse",t.$toolbar).toggleClass("btn-primary btn-default"),t.browsing=!1,a()(t.el).select2("data").length>0&&(t.openAfterInit=!0),t.openAfterInit||(a()(t.el).select2("close"),a()(t.el).select2("open"))):(a()(t.el).select2("close"),a()(t.el).select2("open"))})),a()("button.mode.browse",t.$toolbar).on("click",(function(e){e.preventDefault(),t.browsing?(a()(t.el).select2("close"),a()(t.el).select2("open")):(a()("button.mode.search",t.$toolbar).toggleClass("btn-primary btn-default"),a()("button.mode.browse",t.$toolbar).toggleClass("btn-primary btn-default"),t.browsing=!0,a()(t.el).select2("data").length>0&&(t.openAfterInit=!0),t.openAfterInit||(a()(t.el).select2("close"),a()(t.el).select2("open")))})),a()("a.crumb",t.$toolbar).on("click",(function(e){e.preventDefault(),e.stopPropagation(),t.browseTo(a()(this).attr("href"))})),a()("a.fav",t.$toolbar).on("click",(function(e){e.preventDefault(),e.stopPropagation(),t.browseTo(a()(this).attr("href"))})),t.options.recentlyUsed&&a()(".pat-relateditems-recentlyused-select",t.$toolbar).on("click",(function(e){e.preventDefault();var n=a()(this).data("uid"),i=t.recentlyUsed().filter((function(e){return e.UID===n}));if(i.length>0&&(i=i[0],t.selectItem(i),t.options.maximumSelectionSize>0&&a()(t.el).select2("data").length>=t.options.maximumSelectionSize))return})),t.options.upload&&p.Z.featureSupport.dragAndDrop()&&p.Z.featureSupport.fileApi()&&(t.options.uploadAllowView?a().ajax({url:t.options.uploadAllowView,dataType:"JSON",data:{path:t.options.rootPath+t.currentPath},type:"GET",success:function(e){m(!e.allowUpload)}}):m())},browseTo:function(e){var t=this;t.emit("before-browse"),t.currentPath=e,a()(t.el).select2("close"),t.renderToolbar(),a()(t.el).select2("open"),t.emit("after-browse")},selectItem:function(e){var t=this;t.emit("selecting");var n=a()(t.el).select2("data");if(n.push(e),a()(t.el).select2("data",n,!0),t.options.recentlyUsed){var i=t.recentlyUsed(),o=i.filter((function(t){return t.UID===e.UID}));o.length>0&&i.splice(i.indexOf(o[0]),1),i.push(e),p.Z.storage.set(t.options.recentlyUsedKey,i)}t.emit("selected")},deselectItem:function(e){var t=this;t.emit("deselecting");var n=a()(t.el).select2("data");l().each(n,(function(t,i){t.UID===e.UID&&n.splice(i,1)})),a()(t.el).select2("data",n,!0),t.emit("deselected")},isSelectable:function(e){return!1!==e.selectable&&(null===this.options.selectableTypes||-1!==this.options.selectableTypes.indexOf(e.portal_type))},init:async function(){(await n.e(35808).then(n.t.bind(n,35808,23))).Dropdown,n.e(76492).then(n.bind(n,76492)),this.breadcrumbTemplate=(await n.e(8147).then(n.t.bind(n,8147,17))).default,this.favoriteTemplate=(await n.e(58640).then(n.t.bind(n,58640,17))).default,this.recentlyusedTemplate=(await n.e(77427).then(n.t.bind(n,77427,17))).default,this.resultTemplate=(await n.e(71531).then(n.t.bind(n,71531,17))).default,this.selectionTemplate=(await n.e(8443).then(n.t.bind(n,8443,17))).default,this.toolbarTemplate=(await n.e(16071).then(n.t.bind(n,16071,17))).default;var e=this;e.browsing="search"!==e.options.mode,e.options.rootPath=e.options.rootPath.replace(/\/$/,""),e.currentPath=e.options.basePath.substr(e.options.rootPath.length)||"/",e.setAjax(),e.$el.wrap('<div class="pat-relateditems-container" />'),e.$container=e.$el.parents(".pat-relateditems-container"),u.prototype.initializeValues.call(e),u.prototype.initializeTags.call(e),e.options.formatSelection=function(t){t=a().extend(!0,{Title:"",getIcon:"",getURL:"",path:"",portal_type:"",review_state:""},t);var n=a()(e.applyTemplate("selection",t));if(e.options.scanSelection&&c.Z.scan(n),1==e.options.maximumSelectionSize){var i=t.path,o=i.split("/");i=(o=o.slice(0,-1)).join("/"),e.currentPath=i,e.renderToolbar()}return n};const t=await p.Z.resolveIcon("arrow-left-circle"),i=await p.Z.resolveIcon("arrow-right-circle");e.options.formatResult=function(n){n.selectable=e.isSelectable(n),n=a().extend(!0,{Title:"",getIcon:"",getURL:"",is_folderish:!1,oneLevelUp:!1,iconLevelUp:t,iconLevelDown:i,path:"",portal_type:"",review_state:"",selectable:!1},n),-1!==e.selectedUIDs.indexOf(n.UID)&&(n.selectable=!1);var o=a()(e.applyTemplate("result",n));return a()(".pat-relateditems-result-select",o).on("click",(function(t){if(t.preventDefault(),a()(this).is(".selectable")){var i=a()(this).parents(".pat-relateditems-result");if(i.is(".pat-relateditems-active"))i.removeClass("pat-relateditems-active"),e.deselectItem(n);else{if(e.options.maximumSelectionSize>0)a()(e.el).select2("data").length>=e.options.maximumSelectionSize&&a()(e.el).select2("close");e.selectItem(n),i.addClass("pat-relateditems-active"),e.options.closeOnSelect&&a()(e.el).select2("close")}}})),a()(".pat-relateditems-result-browse",o).on("click",(function(t){t.preventDefault(),t.stopPropagation();var n=a()(this).data("path");e.browseTo(n)})),a()(o)},e.options.initSelection=function(t,n){var i=a()(t).val();if(""!==i){var o=i.split(e.options.separator);new p.Z.QueryHelper(a().extend(!0,{},e.options,{pattern:e})).search("UID","plone.app.querystring.operation.list.contains",o,(function(t){var i=t.results.reduce((function(e,t){return e[t.UID]=t,e}),{});try{n(o.map((function(e){return i[e]})).filter((function(e){return void 0!==e})))}catch(e){}e.openAfterInit&&(a()(e.el).select2("open"),e.openAfterInit=void 0)}),!1)}},e.options.tokenizer=function(e){"auto"===this.options.mode&&(this.browsing=!e)}.bind(this),e.options.id=function(e){return e.UID},await u.prototype.initializeSelect2.call(e),await u.prototype.initializeOrdering.call(e),e.$toolbar=a()('<div class="toolbar d-flex" />'),e.$container.prepend(e.$toolbar),e.$el.on("select2-selecting",(function(t){e.isSelectable(t.choice)||t.preventDefault()})),e.renderToolbar(),e.$el.on("select2-loaded",(function(e){let t=window.innerHeight||document.documentElement.clientHeight;const n=a()(".pat-relateditems-dropdown.select2-drop-active .select2-results")[0],i=t-n.getBoundingClientRect().top-18;a()(n).css("max-height",`${i}px`)})),a()(document).on("keyup",e.$el,(function(t){if(u.prototype.opened.call(e)&&(t.which===m||t.which===h)){t.stopPropagation();var n=t.which===m?".pat-relateditems-result.one-level-up":".select2-highlighted",i=a()(".pat-relateditems-result-browse",n);if(1!==i.length)return;var o=i.data("path");e.browseTo(o)}}))}})},99558:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var i=n(18872),a=n.n(i),o=n(24481),l=n.n(o),s=n(42860),r=n(97238),p=n(47575),c=n.n(p),d='<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(_.contains(linkTypes, \'upload\')){ %>\n    <p class="info"><%- insertLinkHelp %></p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n      <% if(_.contains(linkTypes, \'internal\')){ %>\n      <fieldset class="linkType internal" data-linkType="internal">\n        <legend id="tinylink-internal"><%- internal %></legend>\n        <div>\n          <div class="main mb-2">\n            \x3c!-- this gives the name to the "linkType" --\x3e\n            <input type="text" name="internal" class="form-control" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'upload\')){ %>\n      <fieldset class="linkType upload" data-linkType="upload">\n        <legend id="tinylink-upload"><%- uploadText %></legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'external\')){ %>\n      <fieldset class="linkType external" data-linkType="external">\n        <legend id="tinylink-external"><%- external %></legend>\n        <div class="main mb-2">\n          <label for="external"><%- externalText %></label>\n          <input type="text" name="external" class="form-control" />\n        </div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'email\')){ %>\n      <fieldset class="linkType email" data-linkType="email">\n        <legend id="tinylink-email"><%- emailText %></legend>\n        <div>\n          <div class="main mb-2">\n            <label><%- emailText %></label>\n            <input type="text" name="email" class="form-control" />\n          </div>\n          <div class="mb-2">\n            <label><%- subjectText %></label>\n            <input type="text" name="subject" class="form-control" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'anchor\')){ %>\n      <fieldset class="linkType anchor" data-linkType="anchor">\n        <legend id="tinylink-anchor"><%- anchor %></legend>\n        <div>\n          <div class="main mb-2">\n            <label><%- anchorLabel %></label>\n            <div class="input-wrapper">\n              <select name="anchor" class="pat-select2" data-pat-select2="width:500px"></select>\n            </div>\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n    </div>\x3c!-- / tabs --\x3e\n\n    <div class="common-controls mt-3 border-top pt-3">\n      <div class="mb-2">\n        <label><%- target %></label>\n        <select name="target" class="form-select">\n          <% _.each(targetList, function(target){ %>\n            <option value="<%- target.value %>"><%- target.text %></option>\n          <% }); %>\n        </select>\n      </div>\n      <div class="mb-2">\n        <label><%- titleText %></label>\n        <input type="text" name="title" class="form-control" />\n      </div>\n    </div>\n\n    <input type="submit" class="btn btn-secondary plone-btn me-1" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="btn btn-primary plone-btn" name="insert" value="<%- insertBtn %>" />\n  </div>\n</div>\n',u='<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n    <p class="info"><%- insertImageHelp %></p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n        <% if(_.contains(linkTypes, \'image\')){ %>\n      <fieldset class="linkType image" data-linkType="image">\n        <legend id="tinylink-image"><%- internalImageText %></legend>\n        <div>\n          <div class="main mb-2">\n            <input type="text" name="image" class="form-control" />\n          </div>\n          <div class="scale mb-2">\n            <label><%- scaleText %></label>\n            <select name="scale" class="form-select">\n              <% _.each(Object.keys(pictureVariants), function(key) { %>\n                <option value="<%- key %>" <% if (key === options.defaultSrcset) { %>selected<% } %> >\n                  <%- pictureVariants[key].title %>\n                </option>\n              <% }); %>\n            </select>\n          </div>\n        </div>\n      </fieldset>\n        <% } %>\n\n      <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n      <fieldset class="linkType uploadImage" data-linkType="uploadImage">\n        <legend id="tinylink-uploadImage"><%- uploadText %></legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'externalImage\')){ %>\n      <fieldset class="linkType externalImage" data-linkType="externalImage">\n        <legend id="tinylink-externalImage"><%- externalImage %></legend>\n        <div>\n          <div class="main">\n            <label><%- externalImageText %></label>\n            <input type="text" name="externalImage" class="form-control" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n    </div>\x3c!-- / tabs --\x3e\n\n    <div class="common-controls mt-3 border-top pt-3">\n      <div class="title mb-2">\n        <label><%- titleText %></label>\n        <input type="text" name="title" class="form-control" />\n      </div>\n      <div class="text mb-2">\n        <label><%- altText %></label>\n        <input type="text" name="alt" class="form-control" />\n      </div>\n      <% if(imageCaptioningEnabled){ %>\n      <div class="captionFromDescription form-check mb-2">\n        <input type="checkbox" name="captionFromDescription" class="form-check-input" />\n        <label for="captionFromDescription" class="form-check-label">\n          <%- captionFromDescriptionText %>\n        </label>\n      </div>\n      <div class="caption mb-2">\n        <label><%- captionText %></label>\n        <textarea name="caption" class="form-control"></textarea>\n      </div>\n      <% } %>\n      <div class="align mb-2">\n        <label><%- imageAlignText %></label>\n        <select name="align" class="form-select">\n          <% _.each(Object.keys(options.imageClasses), function(align){ %>\n              <option value="<%- align %>">\n              <%- options.imageClasses[align] %>\n              </option>\n          <% }); %>\n        </select>\n      </div>\n      <div class="enable-zoom mb-2">\n        <input type="checkbox" name="enableImageZoom" class="form-check-input" />\n        <label for="enableImageZoom" class="form-check-label">\n          <%- enableImageZoom %>\n        </label>\n      </div>\n    </div>\n\n    <input type="submit" class="btn btn-secondary plone-btn me-1" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="btn btn-primary plone-btn" name="insert" value="<%- insertBtn %>" />\n\n  </div>\n</div>\n',m=n(24283),h=(s.Z.extend({name:"autotoc",trigger:".pat-autotoc",parser:"mockup",defaults:{section:"section",levels:"h1,h2,h3",IDPrefix:"autotoc-item-",classTOCName:"autotoc-nav",classSectionName:"autotoc-section",classLevelPrefixName:"autotoc-level-",classActiveName:"active",scrollDuration:"slow",scrollEasing:"swing"},init:function(){n.e(4650).then(n.bind(n,4650));var e=this;e.$toc=a()("<nav/>").addClass(e.options.classTOCName),e.options.prependTo?e.$toc.prependTo(e.options.prependTo):e.options.appendTo?e.$toc.appendTo(e.options.appendTo):e.$toc.prependTo(e.$el),e.options.className&&e.$el.addClass(e.options.className),a()(e.options.section,e.$el).addClass(e.options.classSectionName);var t=e.$el.hasClass("autotabs"),i=null;a()(e.options.levels,e.$el).each((function(n){var o=a()(this),l=o.prop("id")?o.prop("id"):o.parents(e.options.section).prop("id");(!l||a()("#"+l).length>0)&&(l=e.options.IDPrefix+e.name+"-"+n),window.location.hash==="#"+l&&(i=l),null===i&&o.hasClass(e.options.classActiveName)&&(i=l),o.data("navref",l),a()("<a/>").appendTo(e.$toc).text(o.text()).attr("id",l).attr("href","#"+l).addClass(e.options.classLevelPrefixName+e.getLevel(o)).on("click",(function(n,i){n.stopPropagation(),n.preventDefault(),i||(i={doScroll:!0,skipHash:!1});var l=a()(this);e.$toc.children("."+e.options.classActiveName).removeClass(e.options.classActiveName),e.$el.children("."+e.options.classActiveName).removeClass(e.options.classActiveName),a()(n.target).addClass(e.options.classActiveName),o.parents(e.options.section).addClass(e.options.classActiveName),!1!==i.doScroll&&e.options.scrollDuration&&o&&!t&&a()("body,html").animate({scrollTop:o.offset().top},e.options.scrollDuration,e.options.scrollEasing),0!==e.$el.parents(".plone-modal").length&&e.$el.trigger("resize.plone-modal.patterns"),a()(this).trigger("clicked"),i.skipHash||window.history&&window.history.pushState&&window.history.pushState({},"","#"+l.attr("id"))})),o.data("autotoc-trigger-id",l)})),i?a()("a#"+i).trigger("click",{doScroll:!0,skipHash:!0}):e.$toc.find("a").first().trigger("click",{doScroll:!1,skipHash:!0})},getLevel:function(e){var t=0;return a().each(this.options.levels.split(","),(function(n,i){if(1===e.filter(i).length)return t=n+1,!1})),t}}),n(81142),n(37103)),g=s.Z.extend({name:"linktype",trigger:".pat-linktype-dummy",defaults:{linkModal:null},init:function(){this.linkModal=this.options.linkModal,this.tinypattern=this.options.tinypattern,this.tiny=this.tinypattern.tiny,this.dom=this.tiny.dom},getEl:function(){return this.$el.find("input")},value:function(){return a().trim(this.getEl().val())},toUrl:function(){return this.value()},load:function(e){let t=this.tiny.dom.getAttrib(e,"data-val");this.getEl().attr("value",t)},set:function(e){var t=this.getEl();t.attr("value",e),t.val(e)},attributes:function(){return{"data-val":this.value()}},updateRelatedItems:function(){}}),f=g.extend({name:"externallinktype",trigger:".pat-externallinktype-dummy",init:function(){g.prototype.init.call(this),this.getEl().on("change",(function(){var e=a()(this).val();new RegExp("https?://").test(e)||-1!==a()(this).val().split("/")[0].indexOf(".")&&a()(this).val("http://"+e)}))}}),v=g.extend({name:"internallinktype",trigger:".pat-internallinktype-dummy",init:function(){this.getEl().length&&(g.prototype.init.call(this),this.getEl().addClass("pat-relateditems"),this.createRelatedItems())},getEl:function(){return this.$el.find("input:not(.select2-input)")},createRelatedItems:function(){if(this.getEl().length){var e=this.linkModal.options.relatedItems;e.upload=!1,this.relatedItems=new m.default(this.getEl(),e)}},updateRelatedItems:function(e){this.relatedItems||this.createRelatedItems(),this.relatedItems.selectItem(e)},value:function(){var e=this.getEl().select2("data");return e&&"object"==typeof e&&(e=e[0]),e},toUrl:function(){var e=this.value();return e?this.tinypattern.generateUrl(e):null},load:function(e){var t=this.tiny.dom.getAttrib(e,"data-val");t&&this.set(t)},set:function(e){this.getEl().val(e).trigger("change"),this.updateRelatedItems(e)},attributes:function(){var e=this.value();return e?{"data-val":e.UID}:{}}}),y=g.extend({name:"uploadlinktype",trigger:".pat-uploadlinktype-dummy",getDelegatedLinkType:function(){return"uploadImage"===this.linkModal.linkType?this.linkModal.linkTypes.image:this.linkModal.linkTypes.internal},toUrl:function(){return this.getDelegatedLinkType().toUrl()},attributes:function(){return this.getDelegatedLinkType().attributes()},set:function(e){return this.getDelegatedLinkType().set(e)},load:function(e){return this.getDelegatedLinkType().load(e)},value:function(){return this.getDelegatedLinkType().value()}}),b=v.extend({name:"imagelinktype",trigger:".pat-imagelinktype-dummy",toUrl:function(){var e=this.value();return this.tinypattern.generateImageUrl(e,this.linkModal.getScaleFromSrcset(this.linkModal.$scale.val()))}}),T=g.extend({name:"emaillinktype",trigger:".pat-emaillinktype-dummy",toUrl:function(){var e=this.value();if(e){var t=this.getSubject(),n="mailto:"+e;return t&&(n+="?subject="+t),n}return null},load:function(e){g.prototype.load.apply(this,[e]),this.linkModal.$subject.val(this.tiny.dom.getAttrib(e,"data-subject"))},getSubject:function(){return this.linkModal.$subject.val()},attributes:function(){var e=g.prototype.attributes.call(this);return e["data-subject"]=this.getSubject(),e}}),x=g.extend({name:"anchorlinktype",trigger:".pat-anchorlinktype-dummy",init:function(){g.prototype.init.call(this),this.$select=this.$el.find("select"),this.anchorNodes=[],this.anchorData=[],this.populate()},value:function(){var e=this.$select.select2("data");return e&&"object"==typeof e&&(e=e.id),e},populate:function(){var e,t,n,i,o,l=this;l.$select.find("option").remove(),l.anchorNodes=[],l.anchorData=[];var s=l.tiny.dom.select(".mceItemAnchor,.mce-item-anchor");for(t=0;t<s.length;t+=1)e=s[t],(i=l.tiny.dom.getAttrib(e,"name"))||(i=l.tiny.dom.getAttrib(e,"id")),""!==i&&(l.anchorNodes.push(e),l.anchorData.push({name:i,title:i}));if((s=l.tiny.dom.select(l.linkModal.options.anchorSelector)).length>0)for(t=0;t<s.length;t+=1)if(e=s[t],""!==(o=a()(e).text().replace(/^\s+|\s+$/g,""))){i=(i=o.toLowerCase().substring(0,1024)).replace(/[^a-z0-9]/g,"-");var r=!1;for(n=0;n<l.anchorNodes.length;n+=1){var p=l.anchorData[n];if(p.name===i){r=!0,p.title=o;break}}r||(l.anchorData.push({name:i,title:o,newAnchor:!0}),l.anchorNodes.push(e))}if(l.anchorNodes.length>0)for(t=0;t<l.anchorData.length;t+=1){var c=l.anchorData[t];l.$select.append('<option value="'+t+'">'+c.title+"</option>")}else l.$select.append("<option>No anchors found..</option>")},getIndex:function(e){for(var t=0;t<this.anchorData.length;t+=1){if(this.anchorData[t].name===e)return t}return 0},toUrl:function(){var e=this.value();if(e){var t=parseInt(e,10),n=this.anchorNodes[t],i=this.anchorData[t];return i.newAnchor&&(n.innerHTML='<a name="'+i.name+'" class="mce-item-anchor"></a>'+n.innerHTML),"#"+i.name}return null},set:function(e){var t=this.getIndex(e);this.$select.select2("data",""+t)}});c().PluginManager.add("ploneimage",(function(e){e.ui.registry.addButton("ploneimage",{icon:"image",text:"Insert image",tooltip:"Insert/edit image",onAction:e.settings.addImageClicked})})),c().PluginManager.add("plonelink",(function(e){e.ui.registry.addButton("plonelink",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onAction:e.settings.addLinkClicked,stateSelector:"a[href]"}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){e.execCommand("unlink")},stateSelector:"a[href]"})}));var k=s.Z.extend({name:"linkmodal",trigger:".pat-linkmodal",defaults:{anchorSelector:"h1,h2,h3",linkTypes:[],initialLinkType:"internal",text:{insertHeading:"Insert Link"},linkTypeClassMapping:{internal:v,upload:y,external:f,email:T,anchor:x,image:b,uploadImage:y,externalImage:g}},linkTypeTemplateMapping:{internal:d,upload:d,external:d,email:d,anchor:d,image:u,uploadImage:u,externalImage:u},template:function(e){return l().template(this.linkTypeTemplateMapping[this.linkType])(e)},init:function(){var e=this;e.tinypattern=e.options.tinypattern,e.tinypattern.options.anchorSelector&&(e.options.anchorSelector=e.tinypattern.options.anchorSelector),e.tiny=e.tinypattern.tiny,e.dom=e.tiny.dom,e.linkType=e.options.initialLinkType,e.linkTypes={},e.modal=r.Z.patterns["plone-modal"].init(e.$el,{html:e.generateModalHtml(),content:null,buttons:".plone-btn",reloadWindowOnClose:!1,templateOptions:{classDialog:"modal-dialog modal-lg",reloadWindowOnClose:!1},actionOptions:{reloadWindowOnClose:!1},backdropOptions:{zIndex:"1340",closeOnClick:!1}}),e.modal.on("shown",(t=>{e.modalShown.apply(e,[t])}))},isOnlyTextSelected:function(){var e=this.tiny.selection.getContent();if(/</.test(e)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(e)||-1===e.indexOf("href=")))return!1;if(this.anchorElm){var t=this.anchorElm.childNodes;if(0===t.length)return!1;for(var n=t.length-1;n>=0;n--)if(3!==t[n].nodeType)return!1}return!0},generateModalHtml:function(){return this.template({options:this.options,upload:this.options.upload,text:this.options.text,insertHeading:this.options.text.insertHeading,insertImageHelp:this.options.text.insertImageHelp,uploadText:this.options.text.upload,insertLinkHelp:this.options.text.insertLinkHelp,internal:this.options.text.internal,external:this.options.text.external,anchor:this.options.text.anchor,anchorLabel:this.options.text.anchorLabel,target:this.options.text.target,linkTypes:this.options.linkTypes,externalText:this.options.text.externalText,emailText:this.options.text.email,subjectText:this.options.text.subject,targetList:this.options.targetList,titleText:this.options.text.title,internalImageText:this.options.text.internalImage,externalImage:this.options.text.externalImage,externalImageText:this.options.text.externalImageText,altText:this.options.text.alt,imageAlignText:this.options.text.imageAlign,captionFromDescriptionText:this.options.text.captionFromDescription,enableImageZoom:this.options.text.enableImageZoom,captionText:this.options.text.caption,scaleText:this.options.text.scale,pictureVariants:this.options.pictureVariants,imageCaptioningEnabled:this.options.imageCaptioningEnabled,cancelBtn:this.options.text.cancelBtn,insertBtn:this.options.text.insertBtn})},isImageMode:function(){return-1!==["image","uploadImage","externalImage"].indexOf(this.linkType)},initElements:function(){var e=this;e.$target=a()('select[name="target"]',e.modal.$modal),e.$button=a()('.modal-footer input[name="insert"]',e.modal.$modal),e.$title=a()('input[name="title"]',e.modal.$modal),e.$subject=a()('input[name="subject"]',e.modal.$modal),e.$alt=a()('input[name="alt"]',e.modal.$modal),e.$align=a()('select[name="align"]',e.modal.$modal),e.$scale=a()('select[name="scale"]',e.modal.$modal),e.$enableImageZoom=a()('input[name="enableImageZoom"]',e.modal.$modal),e.$captionFromDescription=a()('input[name="captionFromDescription"]',e.modal.$modal),e.$caption=a()('textarea[name="caption"]',e.modal.$modal),l().each(e.options.linkTypes,(function(t){var n=a()(".linkType."+t+" .main",e.modal.$modal);n.length&&(e.linkTypes[t]=new e.options.linkTypeClassMapping[t](n,{linkModal:e,tinypattern:e.tinypattern}))})),a()(".autotoc-nav a",e.modal.$modal).click((function(){var t=a()("fieldset.linkType",e.modal.$modal).eq(a()(this).index())[0].className.split(/\s+/);l().each(t,(function(t){-1!==l().indexOf(e.options.linkTypes,t)&&(e.linkType=t)}))})),e.$captionFromDescription.change((function(){this.checked?e.$caption.prop("disabled",!0):e.$caption.prop("disabled",!1)}))},getLinkUrl:function(){return this.linkTypes[this.linkType].toUrl()},getValue:function(){return this.linkTypes[this.linkType].value()},updateAnchor:function(e){var t=this;t.tiny.focus(),t.tiny.selection.setRng(t.rng);var n=t.$target.val(),i=t.$title.val(),o=a().extend(!0,t.data,{title:i||null,target:n||null,"data-linkType":t.linkType,href:e},t.linkTypes[t.linkType].attributes());t.anchorElm?(t.onlyText&&o.text!==t.initialText&&("innerText"in t.anchorElm?t.anchorElm.innerText=t.data.text:t.anchorElm.textContent=t.data.text),t.tiny.dom.setAttribs(t.anchorElm,o),t.tiny.selection.select(t.anchorElm),t.tiny.undoManager.add()):t.onlyText?t.tiny.insertContent(t.tiny.dom.createHTML("a",o,t.tiny.dom.encode(t.data.text))):t.tiny.execCommand("mceInsertLink",!1,o)},focusElement:function(e){this.tiny.focus(),this.tiny.selection.select(e),this.tiny.nodeChanged()},getScaleFromSrcset:function(e){let t=this.options.pictureVariants[e];return t.sourceset[t.sourceset.length-1].scale},updateImage:function(e){var t=this,n=t.$title.val(),i=t.$captionFromDescription.prop("checked"),o=t.$enableImageZoom.prop("checked"),l=t.$caption.val();t.tiny.focus(),t.tiny.selection.setRng(t.rng);var s=["image-richtext",t.$align.val(),"picture-variant-"+t.$scale.val()];(i||l)&&s.push("captioned"),o&&s.push("zoomable");var r,p,c=a().extend(!0,{},{src:e,title:n||null,alt:t.$alt.val(),class:s.join(" "),"data-linkType":t.linkType,"data-picturevariant":t.$scale.val(),"data-scale":t.getScaleFromSrcset(t.$scale.val())},t.linkTypes[t.linkType].attributes());if(l&&!i&&(c["data-captiontext"]=l),t.imgElm&&!t.imgElm.getAttribute("data-mce-object")){const e=t.dom.getAttrib(t.imgElm,"width"),n=t.dom.getAttrib(t.imgElm,"height");e&&(c.width=e),n&&(c.height=n)}else t.imgElm=null;t.imgElm&&t.dom.remove(t.imgElm),c.id="__mcenew",r=t.dom.createHTML("img",c),t.tiny.insertContent(r),t.imgElm=t.dom.get("__mcenew"),t.dom.setAttrib(t.imgElm,"id",null),(p=t.imgElm).onload=p.onerror=function(){p.onload=p.onerror=null,t.focusElement(p)},t.imgElm.complete&&t.focusElement(t.imgElm)},modalShown:function(e){var t=this;t.initElements(),t.initData(),t.options.upload&&(t.$upload=a()(".uploadify-me",t.modal.$modal),t.options.upload.relatedItems=a().extend(!0,{},t.options.relatedItems),t.options.upload.relatedItems.selectableTypes=t.options.folderTypes,t.$upload.addClass("pat-upload"),new h.default(t.$upload,t.options.upload),t.$upload.on("uploadAllCompleted",function(e,n){t.linkTypes.image?(t.linkTypes.image.set(n.data.UID),a()("#"+a()("#tinylink-image",t.modal.$modal).data("navref")).trigger("click")):(t.linkTypes.internal.set(n.data.UID),a()("#"+a()("#tinylink-internal",t.modal.$modal).data("navref")).trigger("click"))}.bind(t))),t.$button.off("click").on("click",(function(e){if(e.preventDefault(),e.stopPropagation(),t.linkType=t.modal.$modal.find("fieldset.active").data("linktype"),"uploadImage"===t.linkType||"upload"===t.linkType){var n=t.$upload.data().patternUpload;n.dropzone.files.length>0&&(n.processUpload(),t.$upload.on("uploadAllCompleted",(function(e,n){var i=0,a=function(){if(i<5&&!t.linkTypes[t.linkType].value())return i+=1,void setTimeout(a,100);var e=t.getLinkUrl();t.updateImage(e),t.hide()};a()})))}var i;try{i=t.getLinkUrl()}catch(e){return}i&&(t.isImageMode()?t.updateImage(i):t.updateAnchor(i),t.hide())})),a()('.modal-footer input[name="cancel"]',t.modal.$modal).click((function(e){e.preventDefault(),t.hide()}))},show:function(){this.modal.show()},hide:function(){this.modal.hide()},initData:function(){var e,t,n=this;if(n.data={},n.initialText=null,n.rng=n.tiny.selection.getRng(),n.selectedElm=n.tiny.selection.getNode(),n.anchorElm=n.tiny.dom.getParent(n.selectedElm,"a[href]"),n.onlyText=n.isOnlyTextSelected(),n.data.text=n.initialText=n.anchorElm?n.anchorElm.innerText||n.anchorElm.textContent:n.tiny.selection.getContent({format:"text"}),n.data.href=n.anchorElm?n.tiny.dom.getAttrib(n.anchorElm,"href"):"",n.anchorElm?n.data.target=n.tiny.dom.getAttrib(n.anchorElm,"target"):n.tiny.settings.default_link_target&&(n.data.target=n.tiny.settings.default_link_target),(e=n.tiny.dom.getAttrib(n.anchorElm,"rel"))&&(n.data.rel=e),(e=n.tiny.dom.getAttrib(n.anchorElm,"class"))&&(n.data.class=e),(e=n.tiny.dom.getAttrib(n.anchorElm,"title"))&&(n.data.title=e),n.tiny.focus(),n.anchorElm=n.dom.getParent(n.selectedElm,"a[href]"),n.isImageMode()){var i;i=n.selectedElm,n.imgElm=i;var o=n.dom.getAttrib(n.imgElm,"src"),l=n.dom.getAttrib(n.imgElm,"data-captiontext");if(n.$title.val(n.dom.getAttrib(n.imgElm,"title")),n.$alt.val(n.dom.getAttrib(n.imgElm,"alt")),a()(n.imgElm).hasClass("zoomable")&&n.$enableImageZoom.prop("checked",!0),a()(n.imgElm).hasClass("captioned")&&!l?(n.$captionFromDescription.prop("checked",!0),n.$caption.prop("disabled",!0)):(a()(n.imgElm).hasClass("captioned"),n.$captionFromDescription.prop("checked",!1)),l&&n.$caption.val(l),(t=n.dom.getAttrib(n.imgElm,"data-linktype"))&&t in n.linkTypes){n.linkType=t,n.linkTypes[n.linkType].load(n.imgElm);var s=n.dom.getAttrib(n.imgElm,"data-picturevariant");n.$scale.val(s),a()("#tinylink-"+n.linkType,n.modal.$modal).trigger("click")}else o&&n.guessImageLink(o);for(var r=n.dom.getAttrib(n.imgElm,"class").split(" "),p=0;p<r.length;p+=1){var c=r[p];for(var d in n.options.imageClasses)-1!==d.indexOf(c)&&n.$align.val(c)}}else if(n.anchorElm){n.focusElement(n.anchorElm);var u;if(u=n.dom.getAttrib(n.anchorElm,"href"),n.$target.val(n.dom.getAttrib(n.anchorElm,"target")),n.$title.val(n.dom.getAttrib(n.anchorElm,"title")),t=n.dom.getAttrib(n.anchorElm,"data-linktype")){n.linkType=t,n.linkTypes[n.linkType].load(n.anchorElm);var m=a()("#tinylink-"+n.linkType,n.modal.$modal);1===m.length&&a()("#"+m.data("autotoc-trigger-id")).trigger("click")}else u&&n.guessAnchorLink(u)}},guessImageLink:function(e){-1!==e.indexOf(this.options.prependToScalePart)?(this.linkType="image",this.$scale.val(this.tinypattern.getScaleFromUrl(e)),this.linkTypes.image.set(this.tinypattern.stripGeneratedUrl(e))):(this.linkType="externalImage",this.linkTypes.externalImage.set(e))},guessAnchorLink:function(e){if(this.options.prependToUrl&&-1!==e.indexOf(this.options.prependToUrl))this.linkType="internal",this.linkTypes.internal.set(this.tinypattern.stripGeneratedUrl(e));else if(-1!==e.indexOf("mailto:")){this.linkType="email";var t=e.substring("mailto:".length,e.length).split("?subject=");this.linkTypes.email.set(t[0]),t.length>1&&this.$subject.val(decodeURIComponent(t[1]))}else"#"===e[0]?(this.linkType="anchor",this.linkTypes.anchor.set(e.substring(1))):(this.linkType="external",this.linkTypes.external.set(e))},setSelectElement:function(e,t){e.find("option:selected").prop("selected",!1),t&&e.find('option[value="'+t+'"]').prop("selected",!0)},reinitialize:function(){this.modal.options.html=this.generateModalHtml()}})},37103:function(e,t,n){n.r(t);var i=n(18872),a=n.n(i),o=n(24481),l=n.n(o),s=n(10354),r=n(42860),p=n(62832);let c;t.default=r.Z.extend({name:"upload",trigger:".pat-upload",parser:"mockup",defaults:{showTitle:!0,url:null,className:"upload",wrap:!1,wrapperTemplate:'<div class="upload-wrapper"/>',fileaddedClassName:"dropping",useTus:!1,container:"",ajaxUpload:!0,paramName:"file",addRemoveLinks:!1,autoCleanResults:!0,previewsContainer:".previews",previewTemplate:null,maxFiles:null,maxFilesize:99999999,allowPathSelection:void 0,relatedItems:{attributes:["UID","Title","Description","getURL","portal_type","path","ModificationDate"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,selectableTypes:["Folder"]}},init:async function(){n.e(83930).then(n.bind(n,83930)),n.e(50794).then(n.bind(n,50794)),c=(await n.e(59625).then(n.t.bind(n,15205,23))).default,c.autoDiscover=!1;const e=(await n.e(94818).then(n.t.bind(n,94818,17))).default;var t=this;void 0===t.options.allowPathSelection&&(t.options.allowPathSelection=t.options.baseUrl&&t.options.relativePath),a()(document).bind("paste",(function(e){var n=e.originalEvent.clipboardData.items;if(n)for(var i=0;i<n.length;i++)if(-1!==n[i].type.indexOf("image")){var a=n[i].getAsFile();t.dropzone.addFile(a)}})),t.currentPath=t.options.currentPath,t.currentFile=0;let i=l().template(e)({_t:s.ZP,allowPathSelection:t.options.allowPathSelection});t.$el.addClass(t.options.className),t.$el.append(i),t.$progress=a()(".progress-bar-success",t.$el),t.options.showTitle||t.$el.find("h2.title").hide(),t.options.ajaxUpload||(a()(".fallback",this.$el).remove(),this.$el.hasClass(".upload-container")?this.$el.addClass("no-ajax-upload"):this.$el.closest(".upload-container").addClass("no-ajax-upload")),t.options.wrap&&(t.$el.wrap(t.options.wrapperTemplate),t.$el=t.$el.parent()),t.options.allowPathSelection?(t.$pathInput=a()('input[name="location"]',t.$el),t.relatedItems=await t.setupRelatedItems(t.$pathInput)):(a()('input[name="location"]',t.$el).parent().remove(),t.relatedItems=null),t.$dropzone=a()(".upload-area",t.$el),a()("div.browse-select button.browse",t.$el).click((function(e){e.preventDefault(),e.stopPropagation(),(!t.options.maxFiles||t.dropzone.files.length<t.options.maxFiles)&&t.dropzone.hiddenFileInput.click()}));var o=await this.getDzoneOptions();try{t.dropzone=new c(t.$dropzone[0],o)}catch(e){throw window.DEBUG&&console.log(e),e}t.dropzone.on("maxfilesreached",(function(){t.showHideControls()})),t.dropzone.on("addedfile",(function(){t.showHideControls()})),t.dropzone.on("removedfile",(function(){t.showHideControls()})),t.dropzone.on("success",(function(e,n){var i;try{i=a().parseJSON(n)}catch(e){i=n}t.$el.trigger("uploadAllCompleted",{data:i,path_uid:t.$pathInput?t.$pathInput.val():null})})),t.options.autoCleanResults&&t.dropzone.on("complete",(function(e){e.status===c.SUCCESS&&setTimeout((function(){a()(e.previewElement).fadeOut()}),3e3)})),t.dropzone.on("complete",(function(e){e.status===c.SUCCESS&&1===t.dropzone.files.length&&t.showHideControls()})),t.dropzone.on("error",(function(e,t,n){void 0!==n&&403!==n.status&&a()(".dz-error-message span",e.previewElement).html((0,s.ZP)("The file transfer failed"))})),t.dropzone.on("totaluploadprogress",(function(e){e=(100*(t.currentFile-1)+e)/(100*t.dropzone.files.length)*100,t.$progress.attr("aria-valuenow",e).css("width",e+"%")})),a()(".upload-all",t.$el).click((function(e){e.preventDefault(),e.stopPropagation(),t.processUpload({finished:function(){t.$progress.attr("aria-valuenow",0).css("width","0%")}})})),t.options.clipboardfile&&t.dropzone.addFile(t.options.clipboardfile)},showHideControls:function(){var e=this;e._showHideTimeout&&clearTimeout(e._showHideTimeout),e._showHideTimeout=setTimeout((function(){e._showHideControls()}),50)},_showHideControls:function(){var e=this,t=a()(".controls",e.$el),n=a()(".browse-select",e.$el),i=a()(".dz-hidden-input");if(e.options.maxFiles&&(e.dropzone.files.length<e.options.maxFiles?(n.show(),i.prop("disabled",!1)):(n.hide(),i.prop("disabled",!0))),e.dropzone.files.length>0){t.fadeIn("slow");var o=e.dropzone.files[0];a()(".dz-error-message span",o.previewElement).html("")}else t.fadeOut("slow")},pathJoin:function(){var e=[];return l().each(arguments,(function(t){t&&("/"===t[0]&&(t=t.substring(1)),"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),e.push(t))})),e.join("/")},getUrl:function(){var e=this,t=e.options.url;if(!t)if(e.options.baseUrl&&e.options.relativePath)"/"!==(t=e.options.baseUrl)[t.length-1]&&(t+="/"),t+=e.pathJoin(e.currentPath,e.options.relativePath);else{var n=e.$el.parents("form");t=n.length>0?n.attr("action"):window.location.href}return t},getDzoneOptions:async function(){let e=await n.e(51967).then(n.t.bind(n,51967,17));e=e.default;var t=this;t.options.clickable=!0;var i=a().extend({},t.options);if(i.url=t.getUrl(),i.headers={"X-CSRF-TOKEN":p.Z.getAuthenticator()},i.uploadMultiple=!1,delete i.wrap,delete i.wrapperTemplate,delete i.resultTemplate,delete i.autoCleanResults,delete i.fileaddedClassName,delete i.useTus,t.options.previewsContainer){var o=t.$el.find(t.options.previewsContainer);o.length>0&&(i.previewsContainer=o[0])}return i.autoProcessQueue=!1,i.previewTemplate=e,i},processUpload:function(e){e||(e={});var t=this,n=!1,i=t.options.useTus,a=t.options.fileaddedClassName,o=e.finished;t.currentFile=0,function e(){n=!0,0===t.dropzone.files.length&&(n=!1);var l=t.dropzone.files[0];if(n&&l.status===c.ERROR&&(l.status=c.QUEUED,n=!1),!n)return t.$el.removeClass(a),void(void 0!==o&&"function"==typeof o&&o());-1!==[c.SUCCESS,c.CANCELED].indexOf(l.status)?(t.dropzone.removeFile(l),e()):l.status!==c.UPLOADING?(i&&window.tus?t.handleTusUpload(l):(t.currentFile+=1,t.dropzone.processFile(l)),setTimeout(e,100)):setTimeout(e,100)}()},handleTusUpload:function(e){var t=this;a()(e.previewElement);e.status=c.UPLOADING,window.tus.upload(e,{endpoint:t.dropzone.options.url,headers:{FILENAME:e.name,"X-CSRF-TOKEN":p.Z.getAuthenticator()},chunkSize:5242880}).fail((function(){window.DEBUG&&console.alert((0,s.ZP)("Error uploading with TUS resumable uploads")),e.status=c.ERROR})).progress((function(e,n,i){var a=n/i*100;t.$progress.attr("aria-valuenow",a).css("width",a+"%"),t.$progress.html((0,s.ZP)("uploading...")+"<br />"+t.formatBytes(n)+" / "+t.formatBytes(i))})).done((function(e,n){n.status=c.SUCCESS,t.dropzone.emit("success",n),t.dropzone.emit("complete",n)}))},formatBytes:function(e){var t=Math.round(e/1024);if(t<1024)return t+" KiB";var n=Math.round(t/1024);return n<1024?n+" MB":Math.round(n/1024)+" GB"},setPath:function(e){var t=this;t.currentPath=e,t.options.url=null,t.options.url=t.dropzone.options.url=t.getUrl()},setupRelatedItems:async function(e){const t=(await Promise.resolve().then(n.bind(n,24283))).default;var i=this,o=i.options.relatedItems;o.upload=!1,i.options.initialFolder&&e.attr("value",i.options.initialFolder);var l=new t(e,o);return l.$el.on("change",(function(){var e=a()(this).select2("data"),t=null;e.length>0&&(t=e[0].path),i.setPath(t)})),l}})}}]);
//# sourceMappingURL=99558.05db5609c499d315d04a.min.js.map