{"version":3,"file":"91.01fe2905b93d776b922d.js?v=01fe2905b93d776b922d","mappings":"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","sources":["webpack://@deathbeds/jupikchr/./src/icons.ts","webpack://@deathbeds/jupikchr/./style/img/alpha-p-box.svg","webpack://@deathbeds/jupikchr/./style/img/fit-to-page-outline.svg","webpack://@deathbeds/jupikchr/./src/md-it-plugin.ts","webpack://@deathbeds/jupikchr/./src/toolbar.ts","webpack://@deathbeds/jupikchr/./src/plugin.ts","webpack://@deathbeds/jupikchr/./src/widget.ts"],"sourcesContent":["import { LabIcon } from '@jupyterlab/ui-components';\n\nimport ALPHA_P_BOX from '../style/img/alpha-p-box.svg';\nimport FIT_BOX from '../style/img/fit-to-page-outline.svg';\n\nexport namespace ICONS {\n  export const P_BOX = new LabIcon({ name: 'pikchr:p-box', svgstr: ALPHA_P_BOX });\n  export const FIT = new LabIcon({ name: 'pikchr:fit', svgstr: FIT_BOX });\n}\n","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 24 24\\\">\\n  <g class=\\\"jp-icon-brand0 jp-icon-selectable\\\" fill=\\\"#0288D1\\\">\\n    <path d=\\\"M9,7V17H11V13H13A2,2 0 0,0 15,11V9A2,2 0 0,0 13,7H9M11,9H13V11H11V9M5,3H19A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5A2,2 0 0,1 3,19V5A2,2 0 0,1 5,3Z\\\" />\\n  </g>\\n</svg>\\n\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 24 24\\\">\\n  <g class=\\\"jp-icon3 jp-icon-selectable\\\" fill=\\\"#616161\\\">\\n    <path d=\\\"M20,2H4C2.89,2 2,2.89 2,4V20C2,21.11 2.89,22 4,22H20C21.11,22 22,21.11 22,20V4C22,2.89 21.11,2 20,2M20,20H4V4H20M13,8V10H11V8H9L12,5L15,8M16,15V13H14V11H16V9L19,12M10,13H8V15L5,12L8,9V11H10M15,16L12,19L9,16H11V14H13V16\\\" />\\n  </g>\\n</svg>\\n\";","import type MarkdownIt from 'markdown-it';\n\nimport { Pikchr } from './pikchr';\nimport { EMOJI, LANGS } from './tokens';\n\nexport function renderPikchrMarkdownIt(md: MarkdownIt): void {\n  let { fence } = md.renderer.rules;\n\n  md.renderer.rules.fence = (tokens, idx, options, env, slf) => {\n    const { info, content } = tokens[idx];\n    const lang = info.trim().split(/\\s+/g)[0];\n\n    if (!LANGS.includes(lang)) {\n      return fence ? fence(tokens, idx, options, env, slf) : '';\n    }\n\n    const placeholderId = Private.nextId();\n    const placeholder = `<img id=\"${placeholderId}\" />`;\n\n    const renderOptions: Pikchr.IRenderOptions = {\n      pikchr: content,\n      tag: 'img',\n      addDimensions: true,\n    };\n\n    void Private.renderLater(renderOptions, placeholderId);\n\n    return placeholder;\n  };\n}\n\nnamespace Private {\n  export const pikchr = Pikchr.initialize();\n  let _nextId = 0;\n  export function nextId() {\n    return `md-it-pikchr-${_nextId++}`;\n  }\n  async function sleep(): Promise<void> {\n    return await new Promise((resolve, reject) => setTimeout(resolve, 100));\n  }\n  export async function renderLater(\n    renderOptions: Pikchr.IRenderOptions,\n    placeholderId: string,\n    retries = 5\n  ): Promise<void> {\n    let imgStr: string;\n    try {\n      imgStr = await Private.pikchr.render(renderOptions);\n    } catch {\n      if (retries > 0) {\n        await sleep();\n        return await renderLater(renderOptions, placeholderId, retries - 1);\n      } else {\n        console.warn(`${EMOJI} failed to render`);\n        return;\n      }\n    }\n    await replacePlaceholder(placeholderId, imgStr);\n  }\n\n  export async function replacePlaceholder(\n    placeholderId: string,\n    imgStr: string,\n    retries = 5\n  ): Promise<void> {\n    const node = document.getElementById(placeholderId);\n    if (node) {\n      node.outerHTML = imgStr;\n      return;\n    }\n    if (retries > 0) {\n      await sleep();\n      return await replacePlaceholder(placeholderId, imgStr, retries - 1);\n    }\n    console.warn(`${EMOJI} failed to update placeholder`);\n    return;\n  }\n}\n","import { CommandRegistry } from '@lumino/commands';\nimport { DisposableDelegate, IDisposable } from '@lumino/disposable';\n\nimport { CommandToolbarButton } from '@jupyterlab/apputils';\nimport { DocumentRegistry } from '@jupyterlab/docregistry';\n\nimport { CommandIDs } from './tokens';\n\n/**\n * A notebook widget extension that adds a button to the toolbar.\n */\nexport class PikchrDocumentToolbar\n  implements DocumentRegistry.IWidgetExtension<any, any>\n{\n  commands: CommandRegistry;\n\n  constructor(commands: CommandRegistry) {\n    this.commands = commands;\n  }\n\n  createNew(panel: any, context: DocumentRegistry.IContext<any>): IDisposable {\n    const img = new CommandToolbarButton({\n      commands: this.commands,\n      id: CommandIDs.img,\n    });\n\n    const fit = new CommandToolbarButton({\n      commands: this.commands,\n      id: CommandIDs.fit,\n    });\n\n    panel.toolbar.insertItem(8, 'img', img);\n    panel.toolbar.insertItem(9, 'fit', fit);\n\n    return new DisposableDelegate(() => {\n      fit.dispose();\n      img.dispose();\n    });\n  }\n}\n","import type MarkdownIt from 'markdown-it';\n\nimport {\n  IMimeDocumentTracker,\n  JupyterFrontEnd,\n  JupyterFrontEndPlugin,\n} from '@jupyterlab/application';\nimport { ICommandPalette, MainAreaWidget } from '@jupyterlab/apputils';\nimport { ICodeMirror } from '@jupyterlab/codemirror';\nimport { IFileBrowserFactory } from '@jupyterlab/filebrowser';\nimport { ILauncher } from '@jupyterlab/launcher';\nimport { IMainMenu } from '@jupyterlab/mainmenu';\nimport { ITranslator, nullTranslator } from '@jupyterlab/translation';\nimport { imageIcon } from '@jupyterlab/ui-components';\n\nimport { ExportMap, IJupyterWidgetRegistry } from '@jupyter-widgets/base';\n\nimport { simpleMarkdownItPlugin } from '@agoose77/jupyterlab-markup';\n\nimport { ICONS } from './icons';\nimport { RenderedPikchr } from './mime';\nimport {\n  CSS,\n  CommandIDs,\n  DOT_PIKCHR,\n  LAUNCHER_CATEGORY,\n  NAME,\n  NS,\n  PALETTE_CATEGORY,\n  VERSION,\n} from './tokens';\nimport { PikchrDocumentToolbar } from './toolbar';\n\nexport interface IMdItPlugin {\n  (md: MarkdownIt): void;\n}\n\nlet _PLUGIN: IMdItPlugin | null = null;\n\n/**\n * Provides ASCII diagrams in code blocks\n */\nexport const markdownPlugin = simpleMarkdownItPlugin(NS, {\n  id: `pikchr`,\n  title: 'pikchr',\n  description: 'pikchr diagrams',\n  documentationUrls: {\n    plugin: 'https://github.com/deathbeds/jupikchr',\n    pikchr: 'https://pikchr.org',\n  },\n  examples: {\n    pikchr: `\n  \\`\\`\\`pikchr\n  arrow right 200% \"Markdown\" \"Source\"\n  box rad 10px \"Markdown\" \"Formatter\" \"(markdown.c)\" fit\n  arrow right 200% \"HTML+SVG\" \"Output\"\n  arrow <-> down 70% from last box.s\n  box same \"Pikchr\" \"Formatter\" \"(pikchr.c)\" fit\n  \\`\\`\\`\n          `,\n  },\n  plugin: async () => {\n    let cachedPlugin = _PLUGIN;\n\n    if (cachedPlugin !== null) {\n      return [cachedPlugin];\n    }\n\n    const { renderPikchrMarkdownIt } = await import('./md-it-plugin');\n    let loadedPlugin = (_PLUGIN = renderPikchrMarkdownIt);\n    return [loadedPlugin];\n  },\n});\n\nconst widgetPlugin: JupyterFrontEndPlugin<void> = {\n  id: `${NS}:widget`,\n  requires: [IJupyterWidgetRegistry],\n  autoStart: true,\n  activate: (app: JupyterFrontEnd, registry: IJupyterWidgetRegistry) => {\n    const reg = {\n      name: NS,\n      version: VERSION,\n      exports: async () => {\n        return (await import('./widget')) as ExportMap;\n      },\n    };\n    registry.registerWidget(reg);\n  },\n};\n\n/**\n * Initialization data for the jupyterlab_robotmode extension.\n */\nconst modePlugin: JupyterFrontEndPlugin<void> = {\n  id: `${NS}:codemirror`,\n  autoStart: true,\n  requires: [ICodeMirror],\n  activate: async (app: JupyterFrontEnd, codeMirror: ICodeMirror) => {\n    const { definePikchrMode } = await import('@deathbeds/codemirror-pikchr');\n    definePikchrMode(codeMirror);\n  },\n};\n\nconst filePlugin: JupyterFrontEndPlugin<void> = {\n  id: `${NS}:file`,\n  autoStart: true,\n  optional: [\n    ITranslator,\n    IFileBrowserFactory,\n    ILauncher,\n    IMainMenu,\n    ICommandPalette,\n    IMimeDocumentTracker,\n  ],\n  activate: (\n    app: JupyterFrontEnd,\n    translator?: ITranslator,\n    browserFactory?: IFileBrowserFactory,\n    launcher?: ILauncher,\n    menu?: IMainMenu,\n    palette?: ICommandPalette,\n    mime?: IMimeDocumentTracker\n  ) => {\n    const { commands, contextMenu } = app;\n\n    const trans = (translator || nullTranslator).load(modePlugin.id);\n\n    commands.addCommand(CommandIDs.createNew, {\n      label: (args) =>\n        args['isPalette'] || args['isContextMenu']\n          ? trans.__('New %1 File', NAME)\n          : trans.__('%1 File', NAME),\n      caption: trans.__('Create a new %1 file', NAME),\n      icon: (args) => (args['isPalette'] ? void 0 : ICONS.P_BOX),\n      execute: async (args) => {\n        const cwd =\n          args['cwd'] ?? browserFactory?.defaultBrowser.model.path ?? undefined;\n        const model = await commands.execute('docmanager:new-untitled', {\n          path: cwd,\n          type: 'file',\n          ext: DOT_PIKCHR,\n        });\n        return commands.execute('docmanager:open', {\n          path: model.path,\n          factory: NAME,\n        });\n      },\n    });\n\n    // add to the file browser context menu\n    contextMenu.addItem({\n      command: CommandIDs.createNew,\n      args: { isContextMenu: true },\n      selector: CSS.CONTEXT_SELECTOR,\n      rank: 3,\n    });\n\n    function getRenderer(): RenderedPikchr | null {\n      if (!mime) {\n        return null;\n      }\n      const { currentWidget } = mime;\n      if (!(currentWidget && currentWidget instanceof MainAreaWidget)) {\n        return null;\n      }\n      const { renderer } = currentWidget.content;\n      if (!(renderer && renderer instanceof RenderedPikchr)) {\n        return null;\n      }\n      return renderer;\n    }\n\n    if (mime) {\n      commands.addCommand(CommandIDs.fit, {\n        icon: ICONS.FIT,\n        caption: trans.__('Toggle fit to container'),\n        execute: async (args: any) => getRenderer()?.toggleFit(),\n      });\n      commands.addCommand(CommandIDs.img, {\n        icon: imageIcon,\n        caption: trans.__('Toggle image rendering'),\n        execute: async (args: any) => getRenderer()?.toggleImage(),\n      });\n      const toolbar = new PikchrDocumentToolbar(commands);\n\n      app.docRegistry.addWidgetExtension(NAME, toolbar);\n    }\n\n    // add to the launcher\n    if (launcher) {\n      launcher.add({\n        command: CommandIDs.createNew,\n        category: LAUNCHER_CATEGORY,\n        rank: 1,\n      });\n    }\n\n    // add to the palette\n    if (palette) {\n      palette.addItem({\n        command: CommandIDs.createNew,\n        args: { isPalette: true },\n        category: PALETTE_CATEGORY,\n      });\n    }\n\n    // add to the menu\n    if (menu) {\n      menu.fileMenu.newMenu.addGroup([{ command: CommandIDs.createNew }], 30);\n    }\n  },\n};\n\nexport default [markdownPlugin, widgetPlugin, modePlugin, filePlugin];\n","import type { IBackboneModelOptions } from '@jupyter-widgets/base';\nimport { DOMWidgetModel, DOMWidgetView, WidgetView } from '@jupyter-widgets/base';\n\nimport { Pikchr } from './pikchr';\nimport { CSS, NS, VERSION } from './tokens';\n\nexport class PikchrView extends DOMWidgetView {\n  initialize(parameters: WidgetView.IInitializeParameters<PikchrModel>): void {\n    super.initialize(parameters);\n    const widget = this.luminoWidget || this.pWidget;\n    widget.addClass(CSS.WIDGET);\n    this.model.on(\n      'change:source change:dark_mode change:tag',\n      this.onSourceChange,\n      this\n    );\n    this.model.on('change:value', this.onValueChange, this);\n  }\n\n  render() {\n    super.render();\n    void this.onSourceChange();\n    this.onValueChange();\n  }\n\n  onValueChange() {\n    this.el.innerHTML = this.model.get('value');\n  }\n\n  async onSourceChange() {\n    const oldSvg = this.model.get('value');\n    const newSvg = await Private.pikchr.render({\n      pikchr: this.model.get('source'),\n      darkMode: this.model.get('dark_mode'),\n      tag: this.model.get('tag'),\n      cssClass: this.model.get('css_class'),\n    });\n    if (oldSvg !== newSvg) {\n      this.model.set({ value: newSvg });\n      this.touch();\n    }\n  }\n}\n\nexport class PikchrModel extends DOMWidgetModel {\n  static model_name = 'PikchrModel';\n  static model_module = NS;\n  static model_module_version = VERSION;\n\n  static view_name = 'PikchrView';\n  static view_module = NS;\n  static view_module_version = VERSION;\n\n  defaults() {\n    return {\n      ...super.defaults(),\n      _model_name: PikchrModel.model_name,\n      _model_module: NS,\n      _model_module_version: VERSION,\n      _view_name: PikchrModel.view_name,\n      _view_module: NS,\n      _view_module_version: VERSION,\n      source: '',\n      value: '',\n      dark_mode: null,\n      css_class: null,\n    };\n  }\n\n  initialize(attributes: Backbone.ObjectHash, options: IBackboneModelOptions) {\n    super.initialize(attributes, options);\n  }\n}\n\nnamespace Private {\n  export const pikchr = Pikchr.initialize();\n}\n"],"names":["ICONS","P_BOX","LabIcon","name","svgstr","FIT","Private","renderPikchrMarkdownIt","md","fence","renderer","rules","tokens","idx","options","env","slf","info","content","lang","trim","split","placeholderId","nextId","placeholder","renderOptions","pikchr","tag","addDimensions","renderLater","_nextId","async","sleep","Promise","resolve","reject","setTimeout","replacePlaceholder","imgStr","retries","node","document","getElementById","console","warn","outerHTML","render","PikchrDocumentToolbar","constructor","commands","this","createNew","panel","context","img","CommandToolbarButton","id","fit","toolbar","insertItem","DisposableDelegate","dispose","_PLUGIN","markdownPlugin","simpleMarkdownItPlugin","NS","title","description","documentationUrls","plugin","examples","widgetPlugin","requires","IJupyterWidgetRegistry","autoStart","activate","app","registry","reg","version","exports","registerWidget","modePlugin","ICodeMirror","codeMirror","definePikchrMode","filePlugin","optional","ITranslator","IFileBrowserFactory","ILauncher","IMainMenu","ICommandPalette","IMimeDocumentTracker","translator","browserFactory","launcher","menu","palette","mime","contextMenu","trans","nullTranslator","load","getRenderer","currentWidget","MainAreaWidget","RenderedPikchr","addCommand","label","args","__","caption","icon","execute","cwd","defaultBrowser","model","path","undefined","type","ext","factory","addItem","command","isContextMenu","selector","rank","toggleFit","imageIcon","toggleImage","docRegistry","addWidgetExtension","add","category","isPalette","fileMenu","newMenu","addGroup","PikchrView","DOMWidgetView","initialize","parameters","super","luminoWidget","pWidget","addClass","on","onSourceChange","onValueChange","el","innerHTML","get","oldSvg","newSvg","darkMode","cssClass","set","value","touch","PikchrModel","DOMWidgetModel","defaults","_model_name","model_name","_model_module","_model_module_version","_view_name","view_name","_view_module","_view_module_version","source","dark_mode","css_class","attributes","model_module","model_module_version","view_module","view_module_version"],"sourceRoot":""}