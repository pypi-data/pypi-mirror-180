"use strict";!function(){const t=function(t,e){postMessage({type:t,data:arguments.length<3?e:Array.prototype.slice.call(arguments,1)})},e=function(){t("stderr",Array.prototype.slice.call(arguments))};self.onerror=function(){const r=arguments[4];r&&"ExitStatus"==r.name&&(s.isDead=!0,e("FATAL ERROR:",r.message),e("Restarting the app requires reloading the page."),t("error",r)),s.setStatus("Exception thrown, see JavaScript console: "+r)},self.onmessage=function r(a){if("pikchr"!==(a=a.data).type)console.warn("Unknown pikchr-worker message type:",a);else{if(s.isDead)return void e("wasm module has exit()ed. Cannot pikchr.");r._||(r._=s.cwrap("pikchr","string",["string","string","number","number","number"])),t("working","start");const i=s.stackSave();try{const e=s.stackAlloc(4),n=s.stackAlloc(4);let o="",l=0,c=null;"string"==typeof a.data?o=a.data:a.data&&"object"==typeof a.data&&(o=a.data.pikchr,l=a.data.darkMode?2:0,a.data.cssClass&&(c=a.data.cssClass)),s.setValue(e,0,"i32"),s.setValue(n,0,"i32");const p={pikchr:o,result:(r._(o,c,l,e,n)||"").trim(),flags:l};p.isError=!(!p.result||!p.result.startsWith("<div")),p.isError?p.width=p.height=null:(p.width=s.getValue(e,"i32"),p.height=s.getValue(n,"i32")),t("pikchr",p)}finally{s.stackRestore(i),t("working","end")}}};const s={print:function(){t("stdout",Array.prototype.slice.call(arguments))},printErr:e,setStatus:function e(s){if(e.last){if(s===e.last.text)return}else e.last={step:0,text:""};e.last.text=s,t("module",{type:"status",data:{step:++e.last.step,text:s||null}})}};importScripts("pikchr.js"),initPikchrModule(s).then((function(e){t("pikchr-ready")}))}();