# Virtualized High Performance Computing Toolkit
# Example of creating 4 VMs and execute post scripts after VM provision
# "barrier" key enforces the order of script execution -
# hello-world2.sh will only be executed on vhpc_vm02 after hello-world1.sh executed on VM vhpc_vm01
# this function will be useful if there are any software dependencies for different VMs when provisioning a cluster
# Modify the file according to your platform and needs

####### Compute VM Macro
[COMPUTE-BASE]
template: Rocky-8.5-template
cpu: 4
# cores_per_socket: 12
memory: 6
datacenter: octo-hpcml-dc01
cluster: hpcml-compute-4
resource_pool: rocky-simple
datastore: vsanDatastore-4
linked: 0
# secure_boot: off

[HOSTLIST-Passthru]
host: w4-hs3-k13{18:19}.eng.vmware.com

[PASSTHRU]
# enable_passthru
device: ['0000:3b:00.0', '0000:3b:00.1']

[NETWORK]
netmask: 255.255.255.0
gateway: 10.203.80.253
dns: 10.142.7.1
domain: eng.vmware.com

[POST-HELLO1]
guest_username: root
guest_password: ca$hc0w
script: ../examples/post-scripts/hello_world1.sh

[POST-HELLO2]
guest_username: root
guest_password: ca$hc0w
script: ../examples/post-scripts/hello_world2.sh

[POST-HELLO3]
guest_username: root
guest_password: ca$hc0w
script: ../examples/post-scripts/hello_world3.sh


##### Execution-2. Create VMs, including head and compute VMs
[_VMS_]
# rocky-simple{1:2}: COMPUTE-BASE NETWORK PASSTHRU HOSTLIST-Passthru ip: 10.203.80.{165:166} port_group: DSwitch-VMNetwork
# rocky-simple{1:2}: COMPUTE-BASE NETWORK HOSTLIST-Passthru ip: 10.203.80.{165:166} port_group: DSwitch-VMNetwork
rocky-simple1: COMPUTE-BASE NETWORK host: w4-hs3-k1318.eng.vmware.com ip: 10.203.80.165 port_group: DSwitch-VMNetwork POST-HELLO1 barrier:0 POST-HELLO2 barrier:1 POST-HELLO3 barrier:2
rocky-simple2: COMPUTE-BASE NETWORK host: w4-hs3-k1319.eng.vmware.com ip: 10.203.80.166 port_group: DSwitch-VMNetwork POST-HELLO1 barrier:0 POST-HELLO2 barrier:1 POST-HELLO3 barrier:2