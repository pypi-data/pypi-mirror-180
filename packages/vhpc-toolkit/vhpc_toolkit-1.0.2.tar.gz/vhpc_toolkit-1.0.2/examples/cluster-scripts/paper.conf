# Virtualized High Performance Computing Toolkit
# Example of creating 4 VMs and execute post scripts after VM provision
# "barrier" key enforces the order of script execution -
# hello-world2.sh will only be executed on vhpc_vm02 after hello-world1.sh executed on VM vhpc_vm01
# this function will be useful if there are any software dependencies for different VMs when provisioning a cluster
# Modify the file according to your platform and needs

####### FRONTEND VM Macro
[FRONTEND]
template: Rocky-8.5-template
cpu: 4
memory: 8
datacenter: octo-hpcml-dc01
cluster: octo-hpcml-mgmt
resource_pool: octo-hpcml-rp-user-vm
datastore: octo-hpcml-mgmt-datastore
linked: 0
secure_boot: off

# [FRONTEND-NETWORK]
# port_group: VMNetwork
# netmask: 255.255.255.0
# gateway: 10.203.80.253
# dns: 10.142.7.1
# domain: eng.vmware.com

[FRONTEND-POST]
guest_username: root
guest_password: ca$hc0w
script: /Users/fyuankun/Workspace/vhpc-toolkit/examples/post-scripts/rocky-hpc-demo-frontend.sh

####### Compute VM Macro
[COMPUTE-BASE]
template: Rocky-8.5-template
cpu: 24
cores_per_socket: 12
memory: 48
datacenter: octo-hpcml-dc01
cluster: hpcml-compute
# cluster: hpcml-compute-4
resource_pool: rocky-hpc-workflow-demo
datastore: vsanDatastore
# datastore: vsanDatastore-4
linked: 0
secure_boot: off

[LATENCY]
latency: high
cpu_reservation: true
memory_reservation: true

[HOSTLIST-SRIOV]
host: w4-hs3-k{1309:1312}.eng.vmware.com
# host: w4-hs3-k{1317:1320}.eng.vmware.com

# [HOSTLIST-Passthru]
# host: w4-hs3-k13{19:20}.eng.vmware.com

[IB-SRIOV]
sriov_port_group: rocky-hpc-demo-IB-SRIOV-PG
pf: 0000:3b:00.0
sriov_dvs_name: rocky-hpc-demo-IB-SRIOV-DVS

[RoCE-SRIOV]
sriov_port_group: rocky-hpc-demo-ROCE-SRIOV-PG
pf: 0000:3b:00.1
sriov_dvs_name: rocky-hpc-demo-ROCE-SRIOV-DVS

# [PASSTHRU]
# device: ['0000:3b:00.0', '0000:3b:00.1']

[NETWORK]
netmask: 255.255.255.0
gateway: 10.203.80.253
dns: ['10.142.7.1', '10.132.7.1']
domain: eng.vmware.com


##### Execution-1. Create VDS
[_DVS_]
rocky-hpc-demo-IB-SRIOV-DVS: pnic: vmnic2 HOSTLIST-SRIOV port_group: rocky-hpc-demo-IB-SRIOV-PG datacenter: octo-hpcml-dc01
rocky-hpc-demo-ROCE-SRIOV-DVS: pnic: vmnic3 HOSTLIST-SRIOV port_group: rocky-hpc-demo-ROCE-SRIOV-PG datacenter: octo-hpcml-dc01

##### Execution-2. Create VMs, including head and compute VMs
[_VMS_]
# Create FRONTEND VM, use port_group overwrite
rocky-hpc-demo-head: FRONTEND NETWORK ip: 10.203.80.160 port_group: VMNetwork FRONTEND-POST
# Create compute VMs
# rocky-hpc-demo{1:2}: COMPUTE-BASE LATENCY NETWORK ip: 10.203.80.{161:162} port_group: DSwitch-VMNetwork IB-SRIOV HOSTLIST-SRIOV 
# rocky-hpc-demo{3:4}: COMPUTE-BASE NETWORK LATENCY PASSTHRU HOSTLIST-Passthru ip: 10.203.80.{163:164} port_group: DSwitch-VMNetwork
rocky-hpc-demo{1:4}: COMPUTE-BASE LATENCY NETWORK ip: 10.203.80.{161:164} port_group: DSwitch-VMNetwork IB-SRIOV RoCE-SRIOV HOSTLIST-SRIOV


